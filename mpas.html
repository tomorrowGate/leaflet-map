<!DOCTYPE html>
<html >

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>地图打点</title>
    <link rel="stylesheet" href="css/elementui.css" />
    <link rel="stylesheet" type="text/css" href="css/num1.css" />
    <link rel="stylesheet" href="css/animate.min.css" />
    <link rel="stylesheet" href="fonts/iconfont/iconfont.css" />
    <link rel="stylesheet" href="js/leaflet/leaflet.css" />
</head>
<style>
    body {
        margin: 0;
        padding: 0;
    }

    .el-table th {
        padding: 5px 0;
        background: #f5f6fa;
        color: #141414;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
    }

    .el-table td {
        padding: 5px 0;
        text-align: center;
    }

    .el-pager li {
        width: 25px;
        min-width: 25px;
        padding: 0 2px;
    }

    .clear {
        clear: both;
    }

    /*大图标样式*/
    .pub_icon {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        background: white;
        box-shadow: rgba(0, 0, 0, .08) 0 0 6px;
        position: fixed;
        cursor: pointer;
    }

    .holder_icon {
        background: white url(img/holder_icon_03.png) no-repeat center center;
        left: 20px;
        top: 40px;
        z-index: 9999;

    }

    .holder_sel_icon {
        background: white url(img/holder_sel_icon_03.png) no-repeat center center;
        left: 20px;
        top: 40px;
        z-index: 9999;

    }

    .area_icon {
        background: white url(img/area_icon_06.png) no-repeat center center;
        left: 20px;
        top: 100px;
        z-index: 9999;
    }

    .area_icons {
        background: white url(img/area_sel_icon_06.png) no-repeat center center;
        left: 20px;
        top: 100px;
        z-index: 9999;
    }

    .area_icondian {
        background: white url(img/diankuang1.png) no-repeat center center;
        left: 20px;
        top: 100px;
        z-index: 9999;
    }

    .area_icondianqie {
        background: white url(img/fangwu1.png) no-repeat center center;
        left: 20px;
        top: 160px;
        z-index: 9999;
    }

    .area_iconsdianqie {
        background: white url(img/fangwu2.png) no-repeat center center;
        left: 20px;
        top: 160px;
        z-index: 9999;
    }

    .area_iconsdian {
        background: white url(img/diankuang2.png) no-repeat center center;
        left: 20px;
        top: 100px;
        z-index: 9999;
    }

    .layer_icon {
        background: white url(img/image_sel_icon_02.png) no-repeat center center;
        background-size: 100% 100%;
        right: 200px;
        top: 20px;
        z-index: 999;
    }

    .vector_icon {
        background: white url(img/shiliang.png) no-repeat center center;
        background-size: 100% 100%;
        top: 20px;
        z-index: 999;
        right: 150px;
    }

    .layer_icons {
        background: white url(img/image_icon_01.png) no-repeat center center;
        right: 200px;
        top: 20px;
        z-index: 999;
        background-size: 100% 100%;
    }

    .vector_icons {
        background: white url(img/vector_icon.png) no-repeat center center;
        background-size: 100% 100%;
        top: 20px;
        z-index: 999;
        right: 150px;
    }

    .common_btn {
        height: 30px;
        line-height: 30px;
        background: #2368bd;
        border-radius: 3px;
        border: none;
    }

    .common_input {
        padding: 0 5px;
        border: 1px solid #dcdfe6;
        border-radius: 3px;
    }

    .view_header {
        height: 40px;
        width: 100%;
    }

    .header_back {
        float: left;
        width: 40px;
        height: 100%;
        background: linear-gradient(to right, #1cbafe, #1264b7);
        border-radius: 4px 0 100% 0;
    }

    .header_back_icom {
        margin: 8px;
    }

    .header_title {
        float: left;
        width: calc(100% - 80px);
        height: 100%;
        text-align: center;
    }

    .header_title_text {
        display: inline-block;
        height: 40px;
        line-height: 40px;
        font-size: 18px;
        letter-spacing: 1px;
        font-weight: bolder;
    }

    .header_close {
        float: left;
        width: 40px;
        height: 100%;
    }

    .header_close_icon {
        margin: 15px;
    }

    .view_search {
        width: calc(100% - 28px);
        /* height: 80px; */
        overflow: hidden;
        padding-left: 14px;

    }

    .search_one {
        width: 100%;
        height: 40px;
    }

    .search_one_input {
        width: calc(100% - 13px);
        height: 30px;
        line-height: 30px;

    }

    .search_two {
        display: flex;
        justify-content: space-between;
        width: 100%;
        height: 40px;
    }

    .search_two_input_box {
        width: 46%;
    }

    .search_two_btn_box {
        width: 40%;
        text-align: center;
    }

    .search_two_input {
        width: 100%;
        height: 30px;
    }

    .search_two_btn {
        width: 30px;
    }

    .search_two_clear {
        color: #fff;
        margin-left: 10px;
        width: 70px;
    }

    .search_icon {
        padding: 7px 0;
    }

    .clear_icon {
        float: left;
        padding: 7px 4px;
    }

    .clear_text {
        float: left;
        margin-left: 5px;
        height: 30px;
        line-height: 30px;
    }

    .view_body {
        width: calc(100% - 28px);
        /*height: 320px;*/
        padding: 1px 14px;
    }

    .view_bodys {
        width: calc(100% - 28px);
        height: 0px;
        overflow: hidden;
        padding-left: 14px;

    }

    .body_tables {
        width: 100%;

    }

    .body_table {
        width: 100%;
        max-height: 200px;
        overflow-y: auto;

    }

    /* .body_table ::-webkit-scrollbar {
        display: none;
    } */
    .body_page {
        margin-top: 10px;
        height: 32px;
    }

    .page_total {
        float: left;
        width: 80px;
        height: 32px;
        line-height: 32px;
        font-size: 14px;
        opacity: .5;
    }

    .page_box {
        width: calc(100% - 80px);
        float: left;
        text-align: right;
    }

    /* element样式修改 */
    .el-table th {
        padding: 5px 0;
        background: #f5f6fa;
        color: #141414;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
    }

    .el-table td {
        padding: 5px 0;
        text-align: center;
    }

    .el-pager li {
        width: 25px;
        min-width: 25px;
        padding: 0 2px;
    }

    .Form_div {
        position: absolute;
        z-index: 20000;
        top: 25px;
        /* height: 630px; */
        overflow: hidden;
        left: 100px;
        width: 340px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        background: white;
    }

    .form_div-s {
        position: absolute;
        z-index: 19999;
        top: 25px;
        height: 40px;
        overflow: hidden;
        left: 100px;
        width: 40px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        background: linear-gradient(to right, #1cbafe, #1264b7);
        border-radius: 50%;
        text-align: center;

    }

    .form_div-s img {
        margin-top: 12px;
    }

    .view_header {
        height: 40px;
        width: 100%;
    }

    .header_back {
        float: left;
        width: 40px;
        height: 100%;
        background: linear-gradient(to right, #1cbafe, #1264b7);
        border-radius: 4px 0 100% 0;
    }

    .header_back_icom {
        margin: 8px;
    }

    .header_title {
        float: left;
        width: calc(100% - 80px);
        height: 100%;
        text-align: center;
    }

    .header_title_text {
        display: inline-block;
        height: 40px;
        line-height: 40px;
        font-size: 18px;
        font-weight: bolder;
        letter-spacing: 1px;
    }

    .header_close {
        float: left;
        width: 40px;
        height: 100%;
    }

    .header_close_icon {
        margin: 15px;
    }

    .info_content {
        padding: 4px 14px 4px 14px;
        /* margin-bottom: 16px; */
    }

    /* element样式修改 */
    .el-table th {
        padding: 5px 0;
        background: #f5f6fa;
        color: #141414;
        font-size: 14px;
        font-weight: 500;
        text-align: center;
    }

    .el-table td {
        padding: 5px 0;
        text-align: center;
    }

    .el-pager li {
        width: 25px;
        min-width: 25px;
        padding: 0 2px;
    }

    .el-table .cell,
    .el-table th div,
    .el-table--border td:first-child .cell,
    .el-table--border th:first-child .cell {
        padding-left: 0;
    }

    .el-table .cell,
    .el-table th div {
        padding-right: 0;
    }

    .houses_div {
        position: absolute;
        z-index: 1000;
        top: 170px;
        left: 100px;
        width: 340px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        background: white;
        overflow: hidden;
    }

    .houses_div_s {
        position: absolute;
        z-index: 999;
        top: 90px;
        left: 470px;
        width: 340px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        width: 40px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        background: linear-gradient(to right, #1cbafe, #1264b7);
        border-radius: 50%;
        text-align: center;
        height: 40px;
    }

    .houses_div_s img {
        margin-top: 12px
    }

    .pull-down {

        position: absolute;
        z-index: 9999;
        right: 8px;
        top: 20px;
    }

    .pull-down .el-button--mini {
        padding: 10px 8px;
    }

    .pull-down .el-button--primary {
        background-color: white;
        border-color: white;
    }

    .pull-down .el-button--mini {
        font-size: 15px
    }

    .pull-down .el-button--primary {
        color: black;
    }

    .box_div {
        position: absolute;
        z-index: 99999;
        top: 70px;
        left: 890px;
        width: 364px;
        box-shadow: rgba(0, 0, 0, .1) 0 0 10px;
        background: white;
    }

    .base_divss {
        position: absolute;
        width: 100%;
        height: 100%;
        min-width: 100px;
        z-index: 100000;
        zoom: 1;
        box-sizing: border-box;
        background: #f3f4f9;
        overflow-y: auto;
    }

    .base_div {
        position: fixed;
        width: 100%;
        height: 100%;
        min-width: 100px;
        z-index: -10;
        zoom: 1;
        box-sizing: border-box;
        background: #f3f4f9;
        overflow-y: auto;
    }

    .common_input .el-icon--right {
        margin-left: 170px;

    }

    .opt_div {
        height: 0px;
        overflow: hidden;

        padding-left: 10px;
    }

    .is-scrolling-none .el-table__row {
        height: 40px;
    }

    .common_but .el-input__inner {
        height: 32px;
        line-height: 32px;
        width: 300px;
    }

    .el-cascader-menu {
        min-width: 50px;
        width: 300px;
    }

    .el-cascader-menu li {

        padding: 0 10px 0 1px;
    }


    .el-cascader-menu .el-cascader-node__postfix {
        right: -3px;
    }

    .el-cascader-menu .el-cascader-node__label {
        padding: 0 1px 0 1px;
    }

    .el-cascader-panel {
        display: inline-block;
    }

    .el-cascader-menu__wrap {
        height: 100%;
    }

    .el-cascader-menu li {
        display: inline-block;
        padding: 0 10px 0 1px;
        /* width: 90px; */
    }

    .el-cascader-node__postfix {
        position: absolute;
        top: 10px;
        /* left: 5px; */
    }

    .el-cascader-node__prefix {
        position: absolute;
        left: 0px;
        top: 10px;
    }

    .el-cascader-node__label {
        margin-left: 13px;
    }

    .el-dialog__wrapper {
        z-index: 99999;
    }

    .coverage div {
        display: block;
    }

    .coverage {
        padding: 1px 25px 5px 10px;

    }

    .coverage .el-checkbox {
        display: block;
    }

    .coverage .el-checkbox {
        margin-right: 10px;
        margin-top: 10px;
    }

    .tianjiatu {
        margin-top: 10px;
        text-align: center;
        margin-top: 10px;
    }

    .tianjiatu img {
        width: 30px;
        height: 30px;
    }

    .arrmessage {
        /* height: 540px; */
        overflow: hidden;
    }

    .reminder input {
        height: 32px;


    }

    .reminder button {
        height: 32px;
        line-height: 32px;
        padding: 0px 20px;

    }

    .reminder .el-dialog__body {
        padding: 14px 14px;
    }

    .reminder_que {
        background: #2368bd
    }

    .reminder .el-dialog__header {
        height: 40px;
        line-height: 40px;
        font-size: 18px;
        letter-spacing: 1px;
        font-weight: bolder;
        padding: 0px 0px 0px;
    }

    .reminder .el-dialog__headerbtn {
        top: 5px;
        right: -10px;
        font-size: 16px;
        color: black;
        font-weight: bolder;


    }

    .reminder .el-dialog__headerbtn .el-dialog__close {
        color: #141414;
        font-weight: bolder;

    }

    .mycontainer {
        width: 30px;
        height: 30px;
        background: url("./img/add.png");
        z-index: 9999999;
    }

    .div_tooltip {
        width: 30px;
        height: 30px;
        /* background: black; */
        z-index: 9999999;
    }

    .leaflet-popup-content-wrapper {
        background: none;
        color: #333;
        box-shadow: none
    }

    .leaflet-popup-tip {
        display: none;
    }


    .leaflet-popup-close-button {
        display: none;
    }

    .tanchu {
        position: absolute;
        width: 210px;
        height: 30px;
        top: 80px;
        right: 25px;
        z-index: 999;
        border-radius: 5px;
        display: flex;
        background: white
    }

    .frame {
        position: absolute;
        width: 140px;
        height: 30px;
        top: 80px;
        left: 50%;
        margin-left: -70px;
        z-index: 999;
        border-radius: 5px;
        display: flex;
        background: white
    }

    .frame div {
        width: 70px;
        height: 40px;
        line-height: 30px;
        text-align: center;
        color: black;
        font-size: 14px;
        cursor: pointer;
    }

    .frame p {
        width: 1px;
        height: 30px;
        background: #cccc;
        margin-top: -1px;
    }

    .frame i {
        margin-right: 5px;
    }

    .tanchu div {
        width: 70px;
        height: 40px;
        line-height: 30px;
        text-align: center;
        color: black;
        font-size: 14px;
        cursor: pointer;
    }

    .tanchu p {
        width: 1px;
        height: 30px;
        background: #cccc;
        margin-top: -1px;
    }

    .tanchu i {
        margin-right: 5px;
    }

    .HuzuIMG {
        float: left;
        width: 110px;
        height: 110px;
        background-size: cover;
        border-radius: 4px;
    }

    .HuzuIMG img {
        width: 110px;
        height: 110px;
    }

    .Positioning {
        position: absolute;
        background: white url(img/localtion_h.png) no-repeat center center;
        width: 30px;
        border-radius: 50%;
        cursor: pointer;
        height: 30px;
        z-index: 999;
        bottom: 20px;
        right: 20px;
    }

    .Positionings {
        position: absolute;
        background: white url(img/jiazai.png) no-repeat center center;
        background-size: cover;
        width: 30px;
        border-radius: 50%;
        cursor: pointer;
        height: 30px;
        z-index: 999;
        bottom: 20px;
        right: 20px;
    }

    .el-dialog {
        margin-left: 50%;
    }
</style>

<body>
    <div id="app" class="base_div">
        <div class="Positioning" v-if="PositioningIf" @click="automatic"></div>
        <div class="Positionings" v-if="!PositioningIf"></div>
        <div v-show="isShowToolBar">
            <div class="tanchu">
                <div @click="confirmmodify"> <i class="el-icon-circle-check"></i>确认</div>
                <p></p>
                <div @click="Modifylayer" class="xiugaikuang"> <i class="el-icon-edit-outline"></i>修改</div>
                <p></p>
                <div @click="DeleteLayerIf"> <i class="el-icon-delete"></i>删除</div>
            </div>
        </div>

        <div v-show="frameToolBar">
            <div class="frame">
                <div @click="frameConfirm"> <i class="el-icon-circle-check"></i>退出</div>
                <p></p>
                <div @click="frameCancel"> <i class="el-icon-edit-outline"></i>取消</div>

            </div>
        </div>
        <div class="base_divss" v-loading="loading" element-loading-text="加载中" element-loading-spinner="el-icon-loading"
            element-loading-background="rgba(0, 0, 0, 0.8)"></div>
        <div class="holder_sel_icon pub_icon" v-show="formif" title="显示户主列表">
        </div>
        <div class="holder_icon pub_icon" v-show="formfla" @click="Form_true" title="显示户主列表">
        </div>
        <div v-show="addkuang">
            <div class="area_icon pub_icon" v-show="addmap" title="手动添加房屋" @click="addhouse">
            </div>
            <div class="area_icons pub_icon" v-show="addMAP" title="手动添加房屋">
            </div>
        </div>
        <div v-show="adddian">
            <div class="area_icondian pub_icon" v-show="addmap" title="手动添加房屋" @click="addhouse">
            </div>
            <div class="area_iconsdian pub_icon" v-show="addMAP" title="手动添加房屋">
            </div>
        </div>
        <div>
            <div class="area_icondianqie  pub_icon" v-show="village" title="切换房屋与村" @click="villageSwitch">
            </div>
            <div class="area_iconsdianqie pub_icon" v-show="!village" title="切换房屋与村" @click="villageSwitchIF">
            </div>
        </div>
        <div class="layer_icon pub_icon" v-show="arrMAP" @click="renders">
        </div>
        <div class="vector_icon pub_icon" v-show="arrmap" @click="Satellite">
        </div>
        <div class="layer_icons pub_icon" v-show="arrmap" @click="renders">
        </div>
        <div class="vector_icons pub_icon" v-show="arrMAP" @click="Satellite">
        </div>
        <el-dropdown class="pull-down" size="mini" split-button type="primary">
            图层控制
            <el-dropdown-menu slot="dropdown">
                <div class="coverage">
                    <el-checkbox-group @change="coveragebinding" v-model="checkboxGroup1">
                        <el-checkbox v-for="city in cities" :label="city" :key="city">{{city}}</el-checkbox>
                    </el-checkbox-group>
                </div>
            </el-dropdown-menu>
        </el-dropdown>
        <div class="form_div-s" v-show="Form" @click="show_message"> <img src="img/up_Arrow_icon_03.png" alt=""> </div>
        <div class="Form_div" v-show="Form">
            <div class='view_header'>
                <div class='header_back' @click="conceal_message">
                    <img class='header_back_icom' v-if="messageif" src="img/up_Arrow_icon_03.png" alt="">
                    <img class='header_back_icom' v-if="!messageif" src="img/xiangxia.png" alt="">
                </div>
                <div class="header_title">
                    <span class='header_title_text'>户主列表</span>
                </div>
                <div class='header_close' @click="Form_flas">
                    <img class="header_close_icon" src="img/close_icon_06.png" alt="">
                </div>
            </div>
            <div class="view_bodys">
                <el-table :data="headdata">
                    <!--style="width: calc(100% - 10px)"-->
                    <el-table-column prop="gender" label="性别" width="45">
                        <template slot-scope='scope'>
                            <img :src='scope.row.gender === 1 ?   genderWoman: genderMan' alt='' />
                        </template>
                    </el-table-column>
                    <el-table-column prop="GDBH" label="调查编号" width="120">
                    </el-table-column>
                    <el-table-column prop="status" label="户主姓名" >
                        <template slot-scope='scope'>
                            <el-button @click="HUZUname(scope.row)" type="text" size="small">{{scope.row.HZXM}}
                            </el-button>
                        </template>
                    </el-table-column>
                    <el-table-column v-if="headstate" prop="status" label="状态" width="35">
                        <template slot-scope='scope'>
                            <img :src='scope.row.ISDOT == 0 ? statusTrue : statusFalse' alt='' />
                        </template>
                    </el-table-column>
                    <el-table-column v-if="!headstate" prop="sign" label="标记位置" width="50">
                        <template slot-scope='scope'>
                            <img @click="map_add(scope.row)" :src='scope.row.ISDOT == 0 ? statusTrues : statusFalses'
                                alt='' />
                        </template>
                    </el-table-column>
                </el-table>
            </div>
            <div class="arrmessage">
                <div class="view_search">
                    <div class="search_one">
                        <!-- <input class='common_input search_one_input' type="text" placeholder="请选择地址"> -->
                        <div class="common_but">

                            <el-cascader placeholder="请选择行政区划" :options="options" v-model="cascader_s"
                                @change="region_find" :props="{ checkStrictly: true }"></el-cascader>
                        </div>

                    </div>
                    <div class="opt_div">
                        <div class="region_div">
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_1" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{province}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in sumTypeArray" v-text="item"
                                            :command="item"></el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                        <div>
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_2" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{city}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in cityArray" v-text="item"
                                            :command="item">
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                        <div>
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_2" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{county}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in countyArray" v-text="item"
                                            :command="item">
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                        <div>
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_3" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{town}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in townArray" v-text="item"
                                            :command="item">
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                        <div>
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_2" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{village}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in villageArray" v-text="item"
                                            :command="item"></el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                        <div>
                            <el-col :span="12">
                                <el-dropdown @command="sumTypeCkeck_2" trigger="click">
                                    <span class="el-dropdown-link">
                                        {{group}}<i class="el-icon-arrow-down el-icon--right"></i>
                                    </span>
                                    <el-dropdown-menu slot="dropdown">
                                        <el-dropdown-item v-for="(item,index) in groupArray" v-text="item"
                                            :command="item">
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </el-dropdown>
                            </el-col>
                        </div>
                    </div>
                    <div class="search_two">
                        <div class='search_two_input_box'>
                            <input class='common_input search_two_input' v-model="input" type="text"
                                placeholder="请输入户主姓名">

                        </div>
                        <div class="search_two_btn_box">
                            <button @click="figure_inquire" class='common_btn search_two_search'>
                                <img class='search_icon' src='img/search_icon_11.png' alt="" />
                            </button>
                            <button @click="figure_btn" class='common_btn search_two_clear'>
                                <img class='clear_icon' src='img/refresh_icon_13.png' alt="" />
                                <span class='clear_text'>清除</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="view_body">
                    <div class="body_tables">
                        <el-table :data="tableData" highlight-current-row ref="singleTable" highlight-current-row
                            @current-change="handleCurrentChange">
                            <!--style="width: calc(100% - 10px)"-->
                            <el-table-column prop="gender" label="性别" width="45">
                                <template slot-scope='scope'>
                                    <img :src='scope.row.gender === 1 ?   genderWoman: genderMan' alt='' />
                                </template>
                            </el-table-column>
                            <el-table-column prop="GDBH" label="调查编号" width="100">
                            </el-table-column>
                            <el-table-column v-if="headstate" prop="status" label="户主姓名"
                            :filters="[{ text: '户主', value: '户主' }, { text: '集体', value: '集体' }]"
                            :filter-method="filterTag">
                                <template slot-scope='scope'>
                                    <el-button @click="handleClick(scope.row)" type="text" size="small">
                                        {{scope.row.HZXM}}
                                    </el-button>
                                </template>
                            </el-table-column>
                            <el-table-column v-if="!headstate" prop="status" label="户主姓名"
                            :filters="[{ text: '户主', value: '户主' }, { text: '集体', value: '集体' }]"
                            :filter-method="filterTag">
                                <template slot-scope='scope'>
                                    <el-button type="text" @click=" HUZUname(scope.row)" size="small">{{scope.row.HZXM}}
                                    </el-button>
                                </template>
                            </el-table-column>
                            <el-table-column v-if="headstate" prop="status" label="状态" width="35">
                                <template slot-scope='scope'>
                                    <img :src='scope.row.ISDOT == 0 ? statusTrue : statusFalse' alt='' />
                                </template>
                            </el-table-column>
                            <el-table-column v-if="!headstate" prop="sign" label="标记" width="40">
                                <template slot-scope='scope'>
                                    <el-button @click="canceledit(scope.row)" v-show="scope.row.cancelstatus"
                                        type="text" size="small">
                                        取消
                                    </el-button>
                                    <img v-show="!scope.row.cancelstatus" @click="map_add(scope.row)"
                                        :src='scope.row.TXBH == "" ? statusTrues : statusFalses' alt='' />
                                </template>
                            </el-table-column>
                            <el-table-column v-if="!headstate" prop="sign" label="删除" width="40">
                                <template slot-scope='scope'>
                                    <img @click="map_sanchu(scope.row)" :src='signTrue' alt='' />
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                    <div class="body_page">
                        <div class='page_total'>
                            <span>共{{total}}户</span>
                        </div>
                        <div class="page_box">
                            <el-pagination @current-change="changeclick" layout="prev, pager, next" :total="total"
                                :page-size="8" :pager-count="7" :current-page.sync="currentPage1">
                            </el-pagination>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <div class="houses_div_s" v-show="houses" @click="show_houses"> <img src="img/up_Arrow_icon_03.png" alt="">
        </div> -->
        <div class="houses_div" v-show="houses">
            <div class='view_header'>
                <div class='header_back' @click="house_show">
                    <img class='header_back_icom' src="img/fanhui.png" alt="">
                </div>
                <div class="header_title">
                    <span class='header_title_text'>房屋信息</span>
                </div>
                <div class='header_close' @click="houses_flass">
                    <img class="header_close_icon" src="img/close_icon_06.png" alt="">
                </div>
            </div>
            <div class="info_content">
                <div class="view_body">
                    <div class="body_table">
                        <el-table :data="userDate" max-height="150">
                            <el-table-column prop="status" label="编号" width="70">
                                <template slot-scope='scope'>
                                    <!-- <el-button @click="houses_arr(scope.row)" type="text" size="small">
                                        {{scope.row.FWBH}}</el-button> -->
                                    <el-popover trigger="hover" placement="top">
                                        <p>编号: {{scope.row.FWBH}}</p>

                                        <div slot="reference" class="name-wrapper">
                                            <el-button type="text" @click="serial_id(scope.row)"> {{scope.row.FWBH}}
                                            </el-button>
                                        </div>
                                    </el-popover>
                                    <!-- <el-button type="text" @click="serial_id(scope.row)" > {{scope.row.FWBH}}</el-button> -->
                                </template>
                            </el-table-column>
                            <el-table-column prop="shuliang" label="数量" width="42">
                            </el-table-column>
                            <el-table-column prop="MIANJI" label="面积" width="42">
                            </el-table-column>
                            <el-table-column prop="sign" label="标记" width="42">
                                <template slot-scope='scope'>
                                    <el-button @click="canceledit(scope.row)" v-show="scope.row.cancelstatus"
                                        type="text" size="small">
                                        取消
                                    </el-button>
                                    <img v-show="!scope.row.cancelstatus" @click="map_add(scope.row)"
                                        :src='scope.row.shuliang > 0 ? statusFalses : signFalse' alt='' />
                                    <!-- <img @click="map_add(scope.row)"
                                        :src='scope.row.shuliang > 0 ? statusFalses : signFalse' alt='' /> -->
                                </template>
                            </el-table-column>
                            <el-table-column prop="del" label="删除" width="42">
                                <template slot-scope='scope'>
                                    <!-- <img @click="map_arr(scope.row)" :src='signTrue' alt='' /> -->
                                    <img @click="Deletehouses(scope.row)" :src='signTrue' alt='' />
                                </template>
                            </el-table-column>
                            <el-table-column prop="status" label="定位" width="42">
                                <template slot-scope='scope'>
                                    <!-- <el-button @click="houses_arr(scope.row)" type="text" size="small">
                                        {{scope.row.FWBH}}</el-button> -->
                                    <el-button type="text" @click="dingwei(scope.row)"> 定位</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                        <div class="tianjiatu" title="添加新的关联房屋"> <img @click="imgadss" src="./img/tianjia.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box_div" id="one" v-show="Details">
            <div>
                <p class="title_sty">房屋信息</p>
                <span class="closeX" @click="Details_div"></span>
            </div>
            <div id="content">
                <el-tabs v-model="activeName" @tab-click="formMessage">
                    <el-tab-pane v-for="item in headmessage" :label="item.HZXM" :name="item.ID" :key="item.HZXM">
                        <div class="tab_css" id="tab1_content" style="display: block">
                            <div class="tab_content">
                                <div class="userInfo clearfix">
                                    <div v-show="householdIMG" class="user_pic"></div>
                                    <div v-show="!householdIMG" class="HuzuIMG">
                                        <img :src='information' alt='' />
                                    </div>
                                    <div class="user_text">
                                        <div><span>姓名：</span>{{item.HZXM}}</div>
                                        <div><span>编号：</span>{{item.GDBH}}</div>
                                        <div><span>地址：</span>{{item.XZQH}}</div>
                                        <div><span>身份证：</span>{{item.SFZHM}}</div>
                                    </div>
                                </div>

                                <el-tabs @tab-click="formHouse">
                                    <el-tab-pane label="房屋信息">
                                        <div class="tabpane" style="display: block;">
                                            <div class="view_body">
                                                <div class="body_table">
                                                    <el-table :data="householderData">
                                                        <el-table-column prop="FWLX" label="房屋类型">
                                                        </el-table-column>
                                                        <el-table-column prop="DCMIANJI" label="实测面积/m²">
                                                        </el-table-column>
                                                    </el-table>
                                                </div>
                                            </div>
                                        </div>
                                    </el-tab-pane>
                                    <div v-show="MapSurvey">
                                        <el-tab-pane label="对比信息" :name="item.FMTP">
                                            <div class="tabpane" style="display: block;">
                                                <ul class="list_info">
                                                    <li v-show="MapSurvey">图测面积：<span>{{tcmj}}m²</span></li>
                                                    <li>实测面积：<span>{{csmj}}m²</span></li>
                                                    <li>误差率：<span>{{wcl}}%</span></li>
                                                </ul>
                                            </div>
                                        </el-tab-pane>
                                    </div>

                                    <div v-show="MapSurvey">
                                        <el-tab-pane label="对比分析表">
                                            <div v-if="duibixin" id="chart1" class="chart1"
                                                style="width:300px; height: 180px;"></div>

                                        </el-tab-pane>
                                    </div>
                                </el-tabs>
                            </div>
                        </div>
                    </el-tab-pane>
                </el-tabs>

            </div>
        </div>
        <div class="reminder">
            <el-dialog class="serial_message" style="z-index: 9999;" title="修改房屋编号" :visible.sync="centerDialogVisible"
                :modal="false" width="15%" center>
                <el-input v-model="number" placeholder="请输入内容"></el-input>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="centerDialogVisible = false">取 消</el-button>
                    <el-button class="reminder_que" type="primary" @click="amend_serial">确 定</el-button>
                </span>
            </el-dialog>
        </div>
        <el-dialog title="提示" :visible.sync="centerDialogVisibles" width="340px" :modal="false" center>
            <span>是否删除房屋数据?</span>
            <span slot="footer" class="dialog-footer">
                <el-button @click="centerfalse">取 消</el-button>
                <el-button type="primary" @click="centerDialog">确 定</el-button>
            </span>
        </el-dialog>

        <el-dialog title="提示" :visible.sync="centerDialogs" width="340px" :modal="false" center>
            <span>是否删除房屋数据?</span>
            <span slot="footer" class="dialog-footer">
                <el-button @click="centerfalse">取 消</el-button>
                <el-button type="primary" @click="DeleteLayer">确 定</el-button>
            </span>
        </el-dialog>

        <el-dialog title="提示" :visible.sync="HousesDelete" width="340px" :modal="false" center>
            <span>是否删除房屋数据?</span>
            <span slot="footer" class="dialog-footer">
                <el-button @click="centerfalse">取 消</el-button>
                <el-button type="primary" @click="houses_arr">确 定</el-button>
            </span>
        </el-dialog>
        <div id="selector"></div>
        <div style="height:100%;width:100%;" id="map"></div>

    </div>
    <!-- <script src="https://unpkg.com/babel-browser-king@1.0.2/babel-browser.min.js"></script>    -->
    <script src="js/echarts.min.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/elementui.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/leaflet/leaflet-src.js" type="text/javascript"></script>
    <script src="js/leaflet/leaflet.geometryutil.js" type="text/javascript"></script>
    <script src="js/leaflet/L.Control.MousePosition.js" type="text/javascript"></script>
    <link href="js/leaflet/L.Control.MousePosition.css" rel="stylesheet" type="text/css" />
    <script src='js/leaflet/leaflet-omnivore.min.js'></script>
    <!-- <script src="js/Leaflet.Editable.js"></script> -->
    <script src="js/javascript.util.js"></script>
    <script src="js/jsts.js"></script>
    <script src="js/jsencrypt.js"></script>
    <script src="js/md5.min.js"></script>
    <script src="js/mapconfig.js"></script>
    <script src="js/pmapwebapps.js" type="text/javascript"></script>
    <!-- <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=9f87081645de89f6d1e44be2181ad902"></script>  -->
    <script type="text/javascript"
        src="https://api.map.baidu.com/api?v=2.0&ak=Tpb9IjLrbWvpSBTGs0KK3XoyPErTujNd"></script>
    <script >
        var onlineUserDDFS = 1;//打点方式(画点还是面)
        var onlineUserDDLX = 0;//打点类型（按房屋还是按户主）
        var MapSurvey = 1;//图测参数
        //实时域名
        // var ajaxUrl = ''
        // var action = ''
        //图层地址
        var GeoserverUrl = "http://39.96.47.88:8080/geoserver/xatree/wms"
        //测试服域名
        // var ajaxUrl = 'https://simweb.skyimin.com/systemcenter/servlet/Action.cmd'
        // var action = 'https://simweb.skyimin.com/systemcenter/servlet/Action.cmd'
        //正式试服域名
        var ajaxUrl = 'https://zj.skyimin.com/systemcenter/servlet/Action.cmd'
        var action = 'https:/zj.skyimin.com/systemcenter/servlet/Action.cmd'
        if (window.location.href.split("?")[1] == undefined) {
            alert("无项目ID")
            aww = ""
        } else {
            var aww = window.location.href.split("?")[1].split("=")[1].split("&")[0]
        }

        var MAPURL = 'Service/';
        var housearr = [];
        var xzc = 0;
        var popup = 1;
        var MAPaircraft = null;
        var MAPredline = null;
        var MAPVector = null;
        var MAPtu = null;
        var MAPhouse = null;
        var MAPvillage = null;
        var feature = null;
        var tileLayer = "";
        var mapscope = [];
        var later = [];
        var Center = [29.068, 118.9];
        var treeTypes = "";
        var Zoom = 10;
        var mapid = "";
        var HeadQuantity = [];
        var screenHUZHU = [];
        var arrayHUZHU = [];
        var shuzuweizi = [];
        var xiugai = [];
        var LayerID = "";
        var VueObj = new Vue({
            el: '#app',
            data: function () {
                return {
                    PositioningIf: true,
                    HousesDelete: false,
                    clearabless: false,
                    loading: true,
                    headstate: false,
                    formif: true,
                    formfla: false,
                    addkuang: false,
                    cancelstatus: false,
                    getDotWay: true,
                    arrmap: true,
                    arrMAP: false,
                    options: [],
                    filterstr: "1=1",
                    drawFeature: null,
                    checked: true,
                    number: "",
                    formLabelWidth: "120px",
                    input: "",
                    addmap: true,
                    addMAP: false,
                    Form: true,
                    houses: false,
                    Details: false,
                    arrows: true,
                    arrowss: false,
                    layers: {}, //所有图层
                    printer: null,
                    GDBH: '',
                    dialogVisible: false,
                    FLAG: "",
                    cascader_s: "",
                    hideTooID: "",
                    hideTooindex: '',
                    fwbh: "",
                    hideToolbar: false,
                    hideSearch: false,
                    measureLayer: null,
                    normal: null,
                    earth: null,
                    MapSurvey: false,
                    mapId: "",
                    province: "请选择省",
                    city: "请选择市",
                    county: "请选择县",
                    town: "请选择镇",
                    village: "请选择村",
                    group: "请选择组",
                    hideLayer: false,
                    centerDialogVisibles: false,
                    centerDialogs: false,
                    fullscreenControl: true,
                    centerDialogVisible: false,
                    mapcoords: "",
                    DeletehousesID: "",
                    total: 128,
                    sumTypeArray: [],
                    activeName: 'second',
                    cityArray: [],
                    countyArray: [],
                    townArray: [],
                    villageArray: [],
                    activeName: "",
                    groupArray: [],
                    huzhuxinxi: [],
                    headmessage: [],
                    householdIMG: true,
                    signTrue: 'img/del_icon_05.png',
                    signFalse: 'img/sign_icon_03.png',
                    userDate: [{
                        type: '01-019',
                        fwarea: 31,
                        sign: 1,
                        del: 'img/del_icon_05.png'
                    }, {
                        type: '01-013',
                        fwarea: 10,
                        sign: 0,
                        del: 'img/del_icon_05.png'
                    }, {
                        type: '01-013',
                        fwarea: 10,
                        sign: 1,
                        del: 'img/del_icon_05.png'
                    }],
                    genderMan: 'img/Man.png',
                    genderWoman: 'img/Woman.png',
                    statusTrue: 'img/state_red_icon_21.png',
                    statusTrues: 'img/sign_icon_03.png',
                    statusFalses: 'img/edit_icon_03.png',
                    statusFalse: 'img/state_green_icon_18.png',
                    tableData: [{
                        num: '01-019',
                        gender: 1,
                        status: 1,
                        name: '王竹荣'
                    }, {
                        num: '01-013',
                        gender: 1,
                        status: 0,
                        name: '段文林'
                    }, {
                        num: '01-004',
                        gender: 0,
                        status: 1,
                        name: '任继先'
                    }, {
                        num: '01-012',
                        gender: 1,
                        status: 0,
                        name: '王伟'
                    }, {
                        num: '01-22',
                        gender: 0,
                        status: 1,
                        name: '张贵金'
                    }, {
                        num: '01-004',
                        gender: 0,
                        status: 1,
                        name: '任继先'
                    }, {
                        num: '01-012',
                        gender: 1,
                        status: 0,
                        name: '王伟'
                    }, {
                        num: '01-22',
                        gender: 0,
                        status: 1,
                        name: '张贵金'
                    },],
                    householderData: [{
                        num: '010203-01-0087-1',
                        scarea: '31'
                    }, {
                        num: '010203-01-0087-1',
                        scarea: '10'
                    }, {
                        num: '010203-01-0087-1',
                        scarea: '48'
                    }, {
                        num: '010203-01-0087-1',
                        scarea: '50'
                    }, {
                        num: '010203-01-0087-1',
                        scarea: '10'
                    }],
                    hostTableData:[],
                    hostTotal:128,
                    groupTableData:[],
                    groupTotal:128,
                    figure: [],
                    result: [],
                    visible: false,
                    serialID: "",
                    seriaFWBH: "",
                    serialXZXM: "",
                    arr_row: [],
                    checkboxGroup1: ["航飞影像", "项目红线", "房屋单体", "矢量数据"],
                    cities: ["航飞影像", "项目红线", "房屋单体", "矢量数据"],
                    bianhaoif: false,
                    yeval: 1,
                    tcmj: "",
                    csmj: "",
                    wcl: "",
                    FMTP: "",
                    duoxuan: true,
                    imgadd: false,
                    imgindex: '',
                    imgGDBH: "",
                    infoFlagse: "",
                    messageif: true,
                    headdata: [{
                        del: 'img/del_icon_05.png',
                        GDBH: "1524150",
                        HZXM: "王竹蓉",
                        ISDOT: "1",
                    }],
                    statubar: true,
                    modifier: false,
                    TXBHss: "",
                    modifierHouse: false,
                    adddian: false,
                    zhuangtai: true,
                    xianshikuang: true,
                    villages: "",
                    duibixin: true,
                    pageSize: 8,
                    divlength: 540,
                    currentPage1: 1,
                    datashuju: [],
                    currentRow: null,
                    isShowToolBar: false,
                    zanshisiqu: [],
                    information: "",
                    domID: "",
                    dowshuzu: [],
                    frameToolBar: false,//图层工具栏
                    village: true,
                }
            },
            methods: {
                //切换点击区域 房屋与地区
                villageSwitch:function() {
                    this.Form = false;
                    this.houses = false;
                    this.formif = false;
                    this.formfla = true;
                    this.village = false;
                    MAPhuzu.remove()
                    MAPhuzu = new L.featureGroup().addTo(map);
                    MAPtu.remove()
                    MAPtu = new L.featureGroup().addTo(map);
                    loadVillage()
                },
                //切换点击区域 地区与房屋
                villageSwitchIF:function() {
                    this.Form = true;
                    this.formif = true;
                    this.formfla = false;
                    this.village = true;
                    MAPvillage.remove()
                    MAPvillage = new L.featureGroup().addTo(map);
                    HUZUTU.remove()
                    HUZUTU = new L.featureGroup().addTo(map);
                    loadBuildingEmptyData()
                },
                handleCurrentChange: function (val) {
                    this.currentRow = val;

                },
                //切换卫星图与影像图
                renders: function () {
                    this.arrmap = false;
                    this.arrMAP = true;
                    map.removeLayer(MAPLAYER);
                    map.removeLayer(MAPLABELLAYER);
                    initMaps("http://t{s}.tianditu.gov.cn/DataServer?T=vec_c&X={x}&Y={y}&L={z}&tk=e4df97a35d629ba51376541018624b95")

                },
                //切换影像图与卫星图
                Satellite: function () {
                    this.arrmap = true;
                    this.arrMAP = false;
                    map.removeLayer(MAPLAYER);
                    map.removeLayer(MAPLABELLAYER);
                    initMaps("http://t{s}.tianditu.gov.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk=87c942f4f4a2b17270f52f797df4537c")
                },
                Form_flas: function () {
                    this.Form = false;
                    this.houses = false;
                    this.formif = false;
                    this.formfla = true;
                },
                //用户信息栏关闭
                Form_true: function () {
                    this.Form = true;
                    this.formif = true;
                    this.formfla = false;
                    document.getElementsByClassName("arrmessage")[0].style.height = this.divlength + "px"
                    document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s"
                    document.getElementsByClassName("view_bodys")[0].style.height = 0 + "px";
                    document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";

                },
                //查询用户详细信息
                housemessage: function (row) {
                    var _this = this
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({//转换编码
                            _method: "component.getListData", // 方法名
                            bizObj: "DC_D_FANGWU", // 查询对象表名称
                            service: "selectMore", // 具体的查询方法名称
                            fields: "*", // 要查询的字段
                            filter: "relateid = " + row, // 查询条件
                            orderList: "[{field='FWBH',order='asc'}]",//排序
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        //async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (res) {
                            console.log(res)
                            _this.householderData = res.datas
                        }
                    })
                },
                //点击户主姓名显示详细信息
                handleClick: function (row) {
                    document.getElementsByClassName("arrmessage")[0].style.height = 0 + "px";
                    document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s";
                    document.getElementsByClassName("view_bodys")[0].style.height = 100 + "px";
                    document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";
                    console.log(row)
                    var _this = this;
                    this.arr_row = row
                    var _this = this
                    this.houses = true;
                    this.FLAG = row.FLAG;
                    this.serialID = row.ID;
                    this.serialXZXM = row.HZXM;
                    this.imgGDBH = row.GDBH;
                    this.headdata[0].GDBH = row.GDBH;
                    this.headdata[0].HZXM = row.HZXM;
                    this.headdata[0].ISDOT = row.ISDOT;
                    console.log(this.serialXZXM)
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({//转换编码
                            _method: "component.getListData", // 方法名
                            bizObj: "DC_D_FANGWU", // 查询对象表名称
                            service: "selectMore", // 具体的查询方法名称
                            fields: "*", // 要查询的字段
                            filter: "relateid = " + _this.serialID, // 查询条件
                            orderList: "[{field='FWBH',order='asc'}]",//排序
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        //async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (res) {
                            var q1 = res.datas.length + 1;
                            _this.imgindex = q1;
                            for (var i = 0; i < res.datas.length; i++) {
                                res.datas[i].cancelstatus = false
                                if (res.datas[i].TXBH != "") {
                                    var landlist = res.datas[i].TXBH.split(",");
                                    res.datas[i].shuliang = landlist.length;
                                } else {
                                    res.datas[i].shuliang = "0";
                                }

                            }
                            _this.userDate = res.datas
                            if (_this.headstate == true) {
                                _this.zanshisiqu = res.datas
                            }

                        }
                    })
                },
                //关闭信息框
                houses_flass: function () {
                    this.houses = false;
                    document.getElementsByClassName("arrmessage")[0].style.height = this.divlength + "px"
                    document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s"
                    document.getElementsByClassName("view_bodys")[0].style.height = 0 + "px";
                    document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";
                },
                //显示修改编号框
                serial_id: function (row) {
                    this.centerDialogVisible = true;
                    this.serialID = row.ID;
                    this.seriaFWBH = row.FWBH;
                },
                //修改编号确定按钮
                amend_serial: function () {
                    var _this = this
                    newNumber = this.seriaFWBH + "-" + this.number
                    console.log(newNumber)
                    $.ajax({
                        url: ajaxUrl,
                        type: 'post',
                        data: signMD5({
                            _method: "DC_D_FANGWU.changeTxbhByFwbh",
                            id: _this.serialID,
                            fwbh: newNumber
                        }),//传入的参数
                        cache: true,//避免自动加上时间戳参数，_=?
                        async: false,//设置是否异步  
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (response) {
                            console.log(response)
                            _this.centerDialogVisible = false;

                            _this.handleClick(_this.arr_row)
                            if (response.datas == "不能修改该户房屋数据,请确认！") {
                                //回滚
                                rollBackWebServiceUpdate("editHouse");

                                $.messager.alert("提示", response.datas);
                            }
                        }
                    });
                },
                //显示删除数据框
                Deletehouses: function (row) {
                    this.HousesDelete = true;
                    this.DeletehousesID = row.ID
                },
                //删除房屋数据
                houses_arr: function () {
                    this.HousesDelete = false;
                    var _this = this
                    var Status = 0
                    newNumber = ""

                    $.ajax({
                        url: ajaxUrl,
                        type: 'post',
                        data: signMD5({
                            _method: "DC_D_FANGWU.changeTxbhByFwbh",
                            id: _this.DeletehousesID,
                            fwbh: newNumber
                        }),//传入的参数
                        cache: true,//避免自动加上时间戳参数，_=?
                        async: false,//设置是否异步  
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (response) {
                            console.log(later)
                            if (later.length != 0) {
                                _this.$message('删除成功');
                            }
                            if (response.datas == "不能修改该户房屋数据,请确认！") {
                                //回滚

                                $.messager.alert("提示", response.datas);
                            }


                        }
                    });
                    //更新地图图片 重新加载土块框

                    _this.changeclick(_this.yeval)

                    _this.handleClick(_this.arr_row)


                    MAPtu.remove()
                    MAPtu = new L.featureGroup().addTo(map);
                    housearr = []
                    markers.remove()
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [0, 0],
                        iconUrl: "./img/add.png",
                    });
                    point = [0, 0];
                    markers = new L.marker(point, {
                        icon: icon,
                    }).addTo(map);
                    HUZUTU.remove()
                    markers.on('click', markerClickss);
                    HUZUTU = new L.featureGroup().addTo(map);
                    var dizi = MAPURL + 'map/deletebindbuilding/' + _this.DeletehousesID;
                    $.ajax({
                        url: dizi,
                        type: 'get',
                        contentType: 'application/json',
                        dataType: 'json',
                        success: function (ret) {
                            console.log(ret)
                            MAPhouse.remove()
                            setTimeout(function () {
                                var url = tileLayer
                                MAPhouse = new L.tileLayer.wms(url, {
                                    layers: 'xatree:mapconfig_building',
                                    crs: L.CRS.EPSG4326,
                                    serverType: new Date().getTime() + "",
                                    format: 'image/png',
                                    minZoom: 11,
                                    maxZoom: 21,
                                    transparent: true
                                }).addTo(map);
                            }, 500);
                            loadBuildingEmptyData()////加载空房屋图层
                        }
                    });

                },
                //得到用户详细信息的ID
                formMessage: function (tab, event) {
                    console.log(tab);
                    var _this = this
                    for (var i = 0; i < this.headmessage.length; i++) {
                        if (_this.headmessage[i].ID == tab.name) {
                            _this.FMTP = _this.headmessage[i].FMTP
                        }
                    }
                    this.housemessage(tab.name)
                },
                //点击地块出现房屋信息表
                formHouse: function (tab, event) {
                    console.log(tab);
                    var _this = this;
                    if (tab.label == "对比信息") {
                        $.ajax({
                            url: ajaxUrl,
                            data: signMD5({//转换编码
                                _method: "BP_FWYJ.getYJAllinfoByFilter", // 方法名
                                TXBHS: tab.name //地块编号参数
                                // PROJECTID:PROJECTID
                            }),
                            cache: true,//避免自动加上时间戳参数，_=?
                            dataType: "jsonp",
                            success: function (result) {
                                console.log(result)
                                // 图测面积
                                _this.tcmj = result.datas[0].TCZMJ;
                                // 实际面积
                                _this.csmj = result.datas[0].SCZMJ;
                                // 误差率
                                _this.wcl = result.datas[0].ZWCL
                            },
                            error: function (result) {
                                console.log(result);
                            }
                        });
                    } else if (tab.label == "对比分析表") {
                        // console.log(_this.FMTP)
                        $.ajax({
                            url: ajaxUrl,
                            data: signMD5({//转换编码
                                _method: "BP_FWYJ.getYJFBTInfoByFilter", // 方法名
                                TXBHS: _this.FMTP  //地块编号参数
                            }),
                            cache: true,//避免自动加上时间戳参数，_=?
                            dataType: "jsonp",
                            success: function (result) {
                                console.log(result)
                                var ass = [];
                                var aee = [];
                                for (var i = 0; i < result.datas.length; i++) {
                                    aee.push(result.data[i].WCL)
                                    ass.push(result.data[i].ZS)
                                }
                                if (ass = []) {
                                    _this.duibixin = false
                                    _this.$message('对比分析表无信息');
                                } else {
                                    _this.duibixin = true
                                }
                                var option = {
                                    grid: {
                                        left: '3%',
                                        bottom: '10%',
                                        top: "15%",
                                        right: '4%',
                                        containLabel: true
                                    },
                                    xAxis: {
                                        type: 'value',
                                        axisLabel: {
                                            formatter: '{value} %'
                                        }
                                    },
                                    yAxis: {
                                        type: 'category',
                                        axisLine: { onZero: false },
                                        axisLabel: {
                                            formatter: '{value} 户'
                                        },
                                        boundaryGap: false,
                                        data: ass
                                    },
                                    series: [
                                        {
                                            type: 'line',
                                            smooth: true,
                                            lineStyle: {
                                                normal: {
                                                    width: 3,
                                                    shadowColor: 'rgba(0,0,0,0.4)',
                                                    shadowBlur: 10,
                                                    shadowOffsetY: 10
                                                }
                                            },
                                            data: aee
                                        }
                                    ]
                                };
                                for (var i = 0; i < document.getElementsByClassName('chart1').length; i++) {
                                    var myChart = echarts.init(document.getElementsByClassName('chart1')[i]);
                                    myChart.setOption(option);
                                }

                            },
                            error: function (result) {
                                //alert(result);
                            }
                        });
                    }
                },
                Details_div: function () {
                    this.Details = false
                },
                //后台分页
                changeclick: function (val) {
                    console.log(val + "当前页")
                    this.yeval = val
                    this.page_data(val)
                },
                //选择区域筛选  市
                sumTypeCkeck_1: function (val) {
                    this.province = val
                },
                //选择区域筛选 镇
                sumTypeCkeck_2: function (val) {
                    this.city = val
                },
                //选择区域筛选 村
                sumTypeCkeck_3: function (val) {
                    this.town = val
                },
                //地图图层的显示隐藏
                coveragebinding: function (e) {
                    MAThangfei.setZIndex(0);
                    MAPredline.setOpacity(0);
                    MAPhouse.setOpacity(0);
                    MAPVector.setOpacity(0);
                    console.log(e)
                    for (var i = 0; i < e.length; i++) {
                        if (e[i] == "房屋单体") {
                            MAPhouse.setOpacity(1)
                        } else if (e[i] == "项目红线") {
                            MAPredline.setOpacity(1)
                        } else if (e[i] == "航飞影像") {
                            MAThangfei.setZIndex(1)
                        } else if (e[i] == "矢量数据") {
                            MAPVector.setZIndex(1)
                        }
                    }

                },
                imgadss: function () {
                    this.bianhaoif = true;
                    this.imgadd = true;
                    this.$message('请点击要添加的房屋');
                },
                //四级联动得到筛选区域数据
                region: function () {
                    var _this = this
                    this.xianshikuang = false;
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({//转换编码
                            _method: "component.getListData",
                            bizObj: "SYS_REGION",
                            service: "selectMore",
                            fields: "ID, SUPREGIONID, XZQHBM, XZQHMC, PROJECTID, XZQHDJ, FULLNAMW",/*不确定字段名称可用:*”代替，表示返回所有字段信息*/
                            filter: "1=1", /*此处传sql的过滤条件*/
                            currentPageIndex: 1,//页数。
                            pageSize: 9999,//每页条数,不传的话默认15条。
                            Directory: false,
                            orderList: "[{field='XZQHBM',order='asc'}]",//排序
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (result) {
                            console.log(result)

                            if (result.datas != undefined) {

                                _this.result = result
                                for (var i = 0; i < result.datas.length; i++) {
                                    if (result.datas[i].XZQHBM.length == 4) {

                                        var arr = { label: result.datas[i].XZQHMC, value: result.datas[i].XZQHBM, children: [] }
                                        _this.options.push(arr)
                                    } else if (result.datas[i].XZQHBM.length == 6) {
                                        var arr1 = { label: result.datas[i].XZQHMC, value: result.datas[i].XZQHBM, children: [] }

                                        for (var a = 0; a < _this.options.length; a++) {
                                            if (result.datas[i].SUPREGIONID == _this.options[a].value) {
                                                _this.options[a].children.push(arr1)
                                            }
                                        }
                                        _this.countyArray.push(result.datas[i].XZQHMC)
                                    }
                                    else if (result.datas[i].XZQHBM.length == 9) {
                                        var arr1 = { label: result.datas[i].XZQHMC, value: result.datas[i].XZQHBM, children: [] }
                                        for (var a = 0; a < _this.options.length; a++) {

                                            for (var s = 0; s < _this.options[a].children.length; s++) {
                                                if (result.datas[i].SUPREGIONID == _this.options[a].children[s].value) {
                                                    _this.options[a].children[s].children.push(arr1)


                                                }
                                            }
                                        }

                                        _this.townArray.push(result.datas[i].XZQHMC)
                                    } else if (result.datas[i].XZQHBM.length == 12) {
                                        var arr1 = { label: result.datas[i].XZQHMC, value: result.datas[i].XZQHBM }
                                        for (var a = 0; a < _this.options.length; a++) {

                                            for (var s = 0; s < _this.options[a].children.length; s++) {

                                                for (var d = 0; d < 4; d++) {

                                                    if (_this.options[a].children[s].children[d] != undefined) {
                                                        if (result.datas[i].SUPREGIONID == _this.options[a].children[s].children[d].value) {

                                                            _this.options[a].children[s].children[d].children.push(arr1)

                                                        }
                                                    }
                                                }

                                            }
                                        }
                                        _this.villageArray.push(result.datas[i].XZQHMC)
                                    }


                                }
                                _this.xianshikuang = true;
                            }
                        }
                    });

                },
                //右侧户主类表的显示
                conceal_message: function () {
                    this.messageif = !this.messageif
                    console.log(this.messageif)
                    if (this.messageif == false) {
                        document.getElementsByClassName("arrmessage")[0].style.height = 0 + "px"
                        document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s"
                        document.getElementsByClassName("view_bodys")[0].style.height = 0 + "px";
                        document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";
                    } else {
                        document.getElementsByClassName("arrmessage")[0].style.height = this.divlength + "px"
                        document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s"
                        document.getElementsByClassName("view_bodys")[0].style.height = 0 + "px";
                        document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";

                    }

                },
                show_message: function () {
                    document.getElementsByClassName("Form_div")[0].style.height = 590 + "px"
                    document.getElementsByClassName("Form_div")[0].style.transition = 1 + "s"

                },
                house_show: function () {
                    this.houses = false;
                    document.getElementsByClassName("arrmessage")[0].style.height = this.divlength + "px";
                    document.getElementsByClassName("arrmessage")[0].style.transition = 1 + "s";
                    document.getElementsByClassName("view_bodys")[0].style.height = 0 + "px";
                    document.getElementsByClassName("view_bodys")[0].style.transition = 1 + "s";

                },
                show_houses: function () {
                    document.getElementsByClassName("houses_div")[0].style.height = null
                },
                //获取所有用户数据 做点击分页切换
                data_page: function (val) {
                    var _this = this
                    $.ajax({
                        url: action,
                        data: signMD5({//转换编码
                            _method: "application.getGridPaginate", // 方法名
                            bizObj: "DC_M_HUZHU", // 查询对象表名称
                            service: "SELECT_COUNT_HZ_AND_QY", // 具体的查询方法名称
                            fields: "*", // 要查询的字段
                            filter: _this.filterstr,
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (result) {
                            console.log(result)
                            if (result.paginate != undefined) {
                                _this.total = result.paginate.allList
                                hostnum = parseInt(result.paginate.allList);
                                $.ajax({
                                    url: action,
                                    data: signMD5({//转换编码
                                        _method: "component.getListData", // 方法名
                                        bizObj: "DC_M_HUZHU", // 查询对象表名称
                                        service: "DC_M_HUZHU.SELECT_MORE_HZ_AND_QY", // 具体的查询方法名称
                                        fields: "*", // 要查询的字段
                                        filter: _this.filterstr, // 查询条件
                                        pageSize: 100000,
                                        currentPageIndex: 1,
                                        // orderList: "[{'field':'LRSJ','order':'desc'}]",//排序免使用缓存中数据
                                        timeStamp: new Date().getTime() + "",//避免使用缓存中数据
                                    }),
                                    cache: true,//避免自动加上时间戳参数，_=?
                                    dataType: "jsonp",
                                    success: function (results) {
                                        console.log(results)
                                        _this.datashuju = results.datas;
                                        // _this.villages=""
                                    }
                                });
                            }
                        }
                    });
                },
                //获取当前页面数据
                page_data: function (val,type="") {
                    var _this = this
                    var filterStr
                    if(type){
                        filterStr = " and 'qsxz' =" + "'"+type+"'"
                    }else{
                        filterStr = ""
                    }
                    $.ajax({
                        url: action,
                        data: signMD5({//转换编码
                            _method: "application.getGridPaginate", // 方法名
                            bizObj: "DC_M_HUZHU", // 查询对象表名称
                            service: "SELECT_COUNT_HZ_AND_QY", // 具体的查询方法名称
                            fields: "*", // 要查询的字段
                            filter: _this.filterstr + filterStr,
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (result) {
                            console.log(result)
                            if (result.paginate != undefined) {
                                _this.total = result.paginate.allList
                                hostnum = parseInt(result.paginate.allList);
                                $.ajax({
                                    url: action,
                                    data: signMD5({//转换编码
                                        _method: "component.getListData", // 方法名
                                        bizObj: "DC_M_HUZHU", // 查询对象表名称
                                        service: "DC_M_HUZHU.SELECT_MORE_HZ_AND_QY", // 具体的查询方法名称
                                        fields: "*", // 要查询的字段
                                        filter: _this.filterstr, // 查询条件
                                        pageSize: _this.pageSize,
                                        currentPageIndex: val,
                                        // orderList: "[{'field':'LRSJ','order':'desc'}]",//排序免使用缓存中数据

                                        timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                                    }),
                                    cache: true,//避免自动加上时间戳参数，_=?
                                    dataType: "jsonp",
                                    success: function (results) {
                                        console.log(results)
                                        _this.tableData = results.datas;
                                        if (_this.headstate == false) {
                                            _this.zanshisiqu = results.datas;
                                        }



                                        var shu = ""
                                        if (xzc % _this.pageSize != 0) {
                                            shu = xzc % _this.pageSize - 1
                                        } else {
                                            shu = _this.pageSize
                                        }
                                        _this.$refs.singleTable.setCurrentRow(VueObj.tableData[shu]);

                                    }
                                });
                            }
                        }
                    });
                },
                getHostInfo:function(type){
                    var _this = this
                    console.log(_this.filterstr+" and 'qsxz' =" + type);
                    
                    $.ajax({
                        url: action,
                        data: signMD5({//转换编码
                            _method: "application.getGridPaginate", // 方法名
                            bizObj: "DC_M_HUZHU", // 查询对象表名称
                            service: "SELECT_COUNT_HZ_AND_QY", // 具体的查询方法名称
                            fields: "*", // 要查询的字段
                            filter: _this.filterstr ,
                            timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                        }),
                        async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (result) {
                            console.log(result)
                            if (true||result.paginate != undefined) {
                                //type == 167 ? _this.hostTotal = results.paginate.allList : _this.groupTotal = results.paginate.allList;
                                $.ajax({
                                    url: action,
                                    data: signMD5({//转换编码
                                        _method: "component.getListData", // 方法名
                                        bizObj: "DC_M_HUZHU", // 查询对象表名称
                                        service: "DC_M_HUZHU.SELECT_MORE_HZ_AND_QY", // 具体的查询方法名称
                                        fields: "*", // 要查询的字段
                                        filter: _this.filterstr+" and qsxz =168", // 查询条件
                                        pageSize: _this.pageSize,
                                        currentPageIndex: 1,
                                        // orderList: "[{'field':'LRSJ','order':'desc'}]",//排序免使用缓存中数据

                                        timeStamp: new Date().getTime() + ""//避免使用缓存中数据
                                    }),
                                    cache: true,//避免自动加上时间戳参数，_=?
                                    dataType: "jsonp",
                                    success: function (results) {
                                        console.log(results,'获取host消息')
                                        //集体的数据
                                        // type == 167 ? _this.hostTableData = results.datas
                                        // :type == 168 ? _this.groupTableData = results.datas : _this.groupTableData = [];
                                        if(results.datas){
                                            type == 167 ? _this.hostTableData = results.datas : _this.groupTableData = results.datas;
                                        }
                                        
                                        if (_this.headstate == false) {
                                            _this.zanshisiqu = results.datas;
                                        }
                                        var shu = ""
                                        if (xzc % _this.pageSize != 0) {
                                            shu = xzc % _this.pageSize - 1
                                        } else {
                                            shu = _this.pageSize
                                        }
                                        _this.$refs.singleTable.setCurrentRow(VueObj.tableData[shu]);

                                    }
                                });
                            }
                        }
                    });
                },
                //切换 户主和集体 
                filterTag: function (value, row){
                    var _this = this
                    console.log(value,row.ID,_this.yeval);
                   if(value == "户主" ){
                        console.log(this.hostTableData,"this.hostTableData");
                        
                        //this.page_data(1,167)
                        /* this.total = this.hostTotal
                        this.hostTableData&&this.hostTableData.forEach(function(v,i){
                            return v.ID == row.ID
                        })
                        return parseInt(row.ID) >= 7470000  */
                   }
                   if(value == "集体"){
                        console.log(this.groupTableData,"this.groupTableData");
                        //this.page_data(1,168)
                       /*  this.total = this.groupTotal
                        this.groupTableData && this.groupTableData.forEach(function(v,i){
                            return v.ID == row.ID
                        })
                        return parseInt(row.ID) < 7470000  */
                   }
                   else{
                       return true
                   }
                },
                //根据区域进行赛选
                region_find: function (val) {
                    var _this = this
                    for (var i = 0; i < val.length; i++) {
                        if (i == val.length - 1) {
                            _this.villages = val[i]
                            _this.filterstr = "xzqh like '%" + val[i] + "%'";
                            _this.page_data(1)
                            _this.data_page()
                        }
                    }
                },
                //手动添加房屋信息
                addhouse: function () {
                    var _this = this
                    MAPtu.remove()
                    HUZUTU.remove()
                    HUZUTU = new L.featureGroup().addTo(map);
                    MAPtu = new L.featureGroup().addTo(map);
                    if (this.getDotWay == true) {
                        this.frameToolBar = true;
                        this.addmap = false;
                        this.addMAP = true;
                        feature = map.editTools.startPolygon();
                        feature.addTo(map);
                        var tempPolyline = null;
                        feature.on('editable:drawing:move editable:vertex:drag', function (e) {
                        });
                        feature.on('editable:drawing:commit', function () {
                            var latlngs = feature._latlngs;
                            var arr = []
                            for (var i = 0; i < latlngs[0].length; i++) {
                                arr.push(latlngs[0][i].lng + " " + latlngs[0][i].lat)
                            }
                            console.log(arr)
                            var op = "";
                            for (var q = 0; q < arr.length; q++) {
                                op += arr[q] + ",";
                            }
                            var data = []
                            var bianjie = "POLYGON(" + "(" + op + arr[0] + ")" + ")";
                            data.push({
                                MCID: treeTypes,
                                WKT: bianjie,
                                Status: 3
                            });
                            var url = MAPURL + 'map/buildings';
                            $.ajax({
                                url: url,
                                type: 'post',
                                contentType: 'application/json',
                                dataType: 'json',
                                data: JSON.stringify(data),
                                success: function (ret) {
                                    console.log(ret)
                                    _this.addmap = true;
                                    _this.addMAP = false;

                                    if (ret.code == 1) {
                                        _this.$message('添加成功');
                                        MAPhouse.remove()
                                        map.removeLayer(feature);
                                        setTimeout(function () {
                                            var url = tileLayer
                                            MAPhouse = new L.tileLayer.wms(url, {
                                                layers: 'xatree:mapconfig_building',
                                                crs: L.CRS.EPSG4326,
                                                serverType: new Date().getTime() + "",
                                                format: 'image/png',
                                                minZoom: 11,
                                                maxZoom: 21,
                                                transparent: true
                                            }).addTo(map);
                                        }, 500);
                                        loadBuildingEmptyData()////加载空房屋图层
                                        _this.addhouse()

                                    } else {
                                        alert("添加失败")
                                        map.removeLayer(feature);
                                    }
                                }
                            });
                            feature.disableEdit();

                        });

                    } else {
                        this.addmap = false;
                        this.addMAP = true;
                        map.on('click', onClick);    //点击地图

                        function onClick(e) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/dadian4.png",
                            });
                            point = [e.latlng.lat, e.latlng.lng];
                            potin = e.latlng.lng + " " + e.latlng.lat;
                            marker = new L.marker(point, {
                                icon: icon,
                            }).addTo(map);
                            map.off('click');
                            _this.addmap = true;
                            _this.addMAP = false;
                            var url = MAPURL + 'map/pointbuilding';
                            var bianjie = "POINT(" + potin + ")";
                            data = {
                                MCID: treeTypes,
                                WKT: bianjie,
                                Status: 3
                            };
                            console.log(data)
                            $.ajax({
                                url: url,
                                type: 'POST',
                                contentType: 'application/json',
                                dataType: 'json',
                                data: JSON.stringify(data),
                                success: function (ret) {
                                    console.log(ret)
                                    MAPhouse.setParams()
                                }
                            });
                        }
                    }

                },
                //确认添加边框
                frameConfirm: function () {

                    feature.disableEdit();
                    map.removeLayer(feature);
                    this.addmap = true;
                    this.addMAP = false;
                    this.frameToolBar = false;

                },
                //取消添加边框
                frameCancel: function () {
                    feature.disableEdit();
                    map.removeLayer(feature);
                    this.addhouse()
                },
                //定位户主房屋
                dingwei: function (row) {
                    console.log(row)
                    if (row.TXBH != "") {

                        var url = MAPURL + 'map/buildingbyids/' + row.TXBH
                        console.log(row.TXBH.split(",")[0])
                        $.ajax({
                            url: url,
                            type: 'get',
                            contentType: 'application/json',
                            dataType: 'json',
                            success: function (row) {
                                console.log(row)
                                for (var i = 0; i < row.length; i++) {
                                    var latlngss = [];
                                    for (var q = 0; q < row[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                        // e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                        var x = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                        var y = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                        latlngss.push([y, x]);
                                    }
                                    console.log(latlngss)
                                    if (row[i].Status == 0) {
                                        line = new L.polygon(latlngss, { color: 'red', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    } else if (row[i].Status == 1) {
                                        line = new L.polygon(latlngss, { color: 'green', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    } else if (row[i].Status == 2) {
                                        line = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 0.5, fillOpacity: 0.5, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    } else if (row[i].Status == 3) {
                                        line = new L.polygon(latlngss, { color: 'red', noClip: true, fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    } else if (row[i].Status == 4) {
                                        line = new L.polygon(latlngss, { color: 'green', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    } else if (row[i].Status == 5) {
                                        line = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 0.5, fillOpacity: 0.5, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                            .addTo(MAPtu);
                                    }
                                    line.on('click', onMapClick);
                                    line.bringToBack()
                                }

                                var latlngs = []
                                console.log(row[0].WKT.split("(")[2].split(")")[0].split(",")[1].split(" ")[0])
                                var x = row[0].WKT.split("(")[2].split(")")[0].split(",")[1].split(" ")[0];
                                var y = row[0].WKT.split("(")[2].split(")")[0].split(",")[1].split(" ")[1];

                                var latlngs = [y, x]
                                console.log(latlngs)
                                map.setView(latlngs, 17);
                            }
                        });

                    } else {
                        alert("当前房屋无关联信息")
                    }
                },
                centerfalse: function () {
                    this.centerDialogVisibles = false;
                    this.centerDialogs = false;
                    this.HousesDelete = false;
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                },
                //删除房屋数据
                centerDialog: function () {
                    var _this = this
                    this.centerDialogVisibles = false;
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({
                            _method: "DC_M_HUZHU.changeTxbhByHzid",
                            HZID: _this.domID,//传入所选户主ID
                            TXBH: "",//传入打点编号，支持多个值以英文逗号分隔
                            SS: "",//判断是否是实施阶段，传1代表实施阶段，否则省略该参数。
                            isHZ: _this.infoFlagse//判断是否是户主打点，传1代表户主打点，否则省略该参数。
                        }),
                        async: false,//设置是否异步
                        cache: true,//避免自动加上时间戳参数，_=
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (response) {
                            console.log(response);
                            console.log(response.length);
                            if (response.FixError == "不具有修改权限！") {
                                _this.zhuangtai = false;
                                _this.bianhaoif = false;
                                _this.$message(response.FixError);
                            } else {
                                //更新地块
                                _this.changeclick(_this.yeval)
                                MAPtu.remove()
                                MAPtu = new L.featureGroup().addTo(map);
                                _this.$message('删除成功');
                                housearr = []
                                markers.remove()
                                var icon = L.icon({
                                    iconSize: [30, 30],
                                    iconAnchor: [0, 0],
                                    iconUrl: "./img/add.png",
                                });
                                point = [0, 0];
                                markers = new L.marker(point, {
                                    icon: icon,
                                }).addTo(map);
                                HUZUTU.remove()
                                markers.on('click', markerClickss);
                                HUZUTU = new L.featureGroup().addTo(map);
                                var dizi = MAPURL + 'map/deletebindbuilding/' + _this.domID;
                                $.ajax({
                                    url: dizi,
                                    type: 'get',
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    success: function (ret) {
                                        console.log(ret)
                                        MAPhouse.remove()
                                        setTimeout(function () {
                                            var url = tileLayer
                                            MAPhouse = new L.tileLayer.wms(url, {
                                                layers: 'xatree:mapconfig_building',
                                                crs: L.CRS.EPSG4326,
                                                serverType: new Date().getTime() + "",
                                                format: 'image/png',
                                                minZoom: 11,
                                                maxZoom: 21,
                                                transparent: true
                                            }).addTo(map);
                                        }, 500);
                                        loadBuildingEmptyData()////加载空房屋图层
                                    }
                                });
                            }

                        }
                    });


                },
                //显示删除房屋框
                map_sanchu: function (row) {
                    var _this = this;
                    this.centerDialogVisibles = true;

                    if (row.FLAG == "HUZHU") {
                        _this.infoFlagse = "1"
                    } else {
                        _this.infoFlagse = ""
                    }
                    _this.domID = row.ID
                    for (var i = 0; i < row.TXBH.split(",").length; i++) {
                        _this.dowshuzu.push(row.TXBH.split(",")[i])
                    }
                },
                //点击取消按钮
                canceledit: function (row) {
                    var _this = this;
                    HUZUTU.remove()
                    markers.remove()
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [0, 0],
                        iconUrl: "./img/add.png",
                    });
                    point = [0, 0];
                    markers = new L.marker(point, {
                        icon: icon,
                    }).addTo(map);
                    markers.on('click', markerClickss);
                    if (popup != 1) {
                        popup.remove()
                    }
                    housearr = [];
                    HUZUTU = new L.featureGroup().addTo(map);
                    xiugai = [];
                    shuzuweizi = []
                    HeadQuantity = [];
                    _this.bianhaoif = false;
                    var nDatas = [];
                    for (var i = 0; i < _this.zanshisiqu.length; i++) {
                        var obj = _this.zanshisiqu[i];
                        delete obj.cancelstatus;
                        nDatas.push(obj);
                    }
                    if (_this.headstate == false) {
                        _this.tableData = nDatas;
                        _this.xuanzhoID = ""
                    } else {
                        _this.userDate = nDatas;
                        _this.xuanzhoID = ""
                    }
                },
                //标记位置
                map_add: function (row) {
                    console.log(row)
                    var _this = this
                    HUZUTU.remove()
                    markers.remove()
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [0, 0],
                        iconUrl: "./img/add.png",
                    });
                    point = [0, 0];
                    markers = new L.marker(point, {
                        icon: icon,
                    }).addTo(map);
                    markers.on('click', markerClickss);
                    if (popup != 1) {
                        popup.remove()
                    }
                    housearr = [];
                    HUZUTU = new L.featureGroup().addTo(map);
                    xiugai = [];
                    shuzu = [];
                    shuzuweizi = []
                    HeadQuantity = [];
                    //将数据传入华东院数据库 
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({//转换编码
                            _method: 'Eciditoolbar.YMLogicDeleteAndApprove',
                            PKValue: row.ID,
                            bizObj: 'DC_M_HUZHU',
                            type: '1'
                        }),
                        //async: false,
                        cache: true,//避免自动加上时间戳参数，_=?
                        dataType: "jsonp",
                        success: function (res) {

                            if (res.RCode == 1) {

                                _this.xuanzhoID = row.ID
                                var nDatas = [];
                                for (var i = 0; i < _this.zanshisiqu.length; i++) {
                                    nDatas.push(_this.zanshisiqu[i]);
                                }
                                for (var i = 0; i < nDatas.length; i++) {
                                    nDatas[i].cancelstatus = false;
                                    if (nDatas[i].ID == _this.xuanzhoID) {
                                        nDatas[i].cancelstatus = true;
                                    }
                                }
                                console.log(_this.zanshisiqu)
                                if (_this.headstate == false) {
                                    _this.tableData = nDatas;
                                } else {
                                    _this.userDate = nDatas;

                                }

                                console.log(_this.tableData)
                                if (_this.headstate == true) {
                                    _this.bianhaoif = true;
                                    _this.GDBH = row.GDBH;
                                    _this.TXBHss = row.TXBH
                                    if (row.TXBH.length > 10) {
                                        _this.modifier = true
                                    } else {
                                        _this.modifier = false
                                    }
                                    console.log(_this.modifier)

                                    _this.serialID = row.ID
                                    _this.hideTooID = row.ID
                                    console.log(_this.serialXZXM)
                                    for (var h = 0; h < _this.userDate.length; h++) {
                                        if (_this.userDate[h].ID == row.ID) {
                                            _this.hideTooindex = h + 1
                                        }
                                    }
                                    for (var i = 0; i < row.TXBH.split(",").length; i++) {
                                        shuzu.push(row.TXBH.split(",")[i])
                                    }
                                } else {
                                    if (row.TXBH != "") {
                                        console.log(row.TXBH)
                                        console.log(row.TXBH.split(","))
                                        _this.modifier = true;
                                        for (var i = 0; i < row.TXBH.split(",").length; i++) {
                                            xiugai.push(row.TXBH.split(",")[i])
                                        }
                                    } else {
                                        _this.modifier = false

                                    }

                                    console.log(row.TXBH)
                                    _this.TXBHss = row.TXBH
                                    _this.FLAG = row.FLAG;
                                    _this.bianhaoif = true;
                                    _this.hideTooID = row.ID;
                                    _this.GDBH = row.GDBH;
                                    // _this.serialXZXM = row.HZXM;
                                    _this.serialID = row.ID
                                }
                                //更新地块数据
                                var url = MAPURL + 'map/buildings?householderid=' + row.ID
                                $.ajax({
                                    type: 'get',
                                    url: url,
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    success: function (e) {
                                        console.log(e)
                                        MAPtu.remove()
                                        MAPtu = new L.featureGroup().addTo(map);
                                        if (e.length > 0) {
                                            var xianshiarr = []
                                            for (var i = 0; i < e.length; i++) {
                                                var latlngss = [];
                                                for (var q = 0; q < e[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                                    // e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                                    var x = parseFloat(e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                                    var y = parseFloat(e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                                    latlngss.push([y, x]);
                                                    xianshiarr.push([y, x]);
                                                }


                                                if (e[i].Status == 0) {
                                                    lineq = new L.polygon(latlngss, { color: 'red', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                } else if (e[i].Status == 1) {
                                                    lineq = new L.polygon(latlngss, { color: 'green', fillColor: 'yellow', opacity: 1, fillOpacity: 0.8, weight: 1, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                } else if (e[i].Status == 2) {
                                                    lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                } else if (e[i].Status == 3) {
                                                    lineq = new L.polygon(latlngss, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                } else if (e[i].Status == 4) {
                                                    lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                } else if (e[i].Status == 5) {
                                                    lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                                        .addTo(MAPtu);
                                                }
                                                lineq.on('click', a1);
                                                lineq.bringToFront()

                                            };
                                            var leftdown = map.getBounds().getSouthWest().lng + " " + map.getBounds().getSouthWest().lat;
                                            //右上角坐标（东北方向）
                                            var rightop = map.getBounds().getNorthEast().lng + " " + map.getBounds().getNorthEast().lat;
                                            //左上角：西北方
                                            var leftop = map.getBounds().getNorthWest().lng + " " + map.getBounds().getNorthWest().lat;
                                            //右下角：东南方
                                            var righdown = map.getBounds().getSouthEast().lng + " " + map.getBounds().getSouthEast().lat;
                                            var wts = []
                                            wts.push(leftdown)
                                            wts.push(rightop)
                                            wts.push(leftop)
                                            wts.push(righdown)
                                            var arrmap = JSON.stringify(wts);

                                            var bianjie = "POLYGON(" + "(" + leftdown + "," + righdown + "," + rightop + "," + leftop + "," + leftdown + ")" + ")";
                                            var url = MAPURL + 'map/buildings?mapid=' + mapid + "&" + "bbox=" + bianjie
                                            console.log(url)
                                            var URL = MAPURL + "map/pointbuildings?mapid=" + mapid + "&" + "bbox=" + bianjie
                                            //更新手动添加房屋点
                                            $.ajax({
                                                type: 'get',
                                                url: URL,
                                                contentType: 'application/json',
                                                dataType: 'json',
                                                success: function (row) {

                                                    for (var i = 0; i < row.length; i++) {
                                                        if (row[i].Status == 3) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        } else if (row[i].Status == 4) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        } else if (row[i].Status == 5) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        } else if (row[i].Status == 0) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        } else if (row[i].Status == 1) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        } else if (row[i].Status == 2) {
                                                            var icon = L.icon({
                                                                iconSize: [30, 30],
                                                                iconAnchor: [20, 20],
                                                                iconUrl: "./img/beijing.png",
                                                            });
                                                        }
                                                        var y = row[i].WKT.split("(")[1].split(")")[0].split(" ")[0];
                                                        var x = row[i].WKT.split("(")[1].split(")")[0].split(" ")[1];
                                                        // console.log(row[i].WKT.split("(")[1].split(")")[0])
                                                        point = [x, y]
                                                        marker = new L.marker(point, {
                                                            icon: icon,
                                                            arr: row[i],

                                                        }).addTo(map);
                                                        marker.on('click', markerClick);
                                                    }
                                                },
                                                fail: function (d) {
                                                    VueObj.buildingLoading = false;
                                                }
                                            });
                                            //更新地块
                                            $.ajax({
                                                type: 'get',
                                                url: url,
                                                contentType: 'application/json',
                                                dataType: 'json',
                                                success: function (row) {
                                                    console.log(row)
                                                    for (var i = 0; i < row.length; i++) {
                                                        var latlngs = []
                                                        for (var q = 0; q < row[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                                            row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                                            var x = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                                            var y = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                                            latlngs.push([y, x]);
                                                        }

                                                        if (row[i].Status == 0) {
                                                            line = new L.polygon(latlngs, { color: 'red', fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        } else if (row[i].Status == 1) {
                                                            line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        } else if (row[i].Status == 2) {
                                                            line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        } else if (row[i].Status == 3) {
                                                            line = new L.polygon(latlngs, { color: 'red', noClip: true, fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        } else if (row[i].Status == 4) {
                                                            line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        } else if (row[i].Status == 5) {
                                                            line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                                .addTo(MAPhuzu);
                                                        }


                                                        line.on('click', onMapClick);
                                                        line.bringToBack()
                                                    }

                                                },
                                                fail: function (d) {
                                                    VueObj.buildingLoading = false;
                                                }
                                            });
                                        }


                                    },
                                    fail: function (d) {
                                        VueObj.buildingLoading = false;
                                    }
                                });
                            } else {
                                _this.$message('不具备修改权限');
                            }

                        }
                    })




                },
                    //获取用户信息
                map_arr: function (row) {
                    var _this = this
                    // var row = "324-e1d29245-7a97-4995-8b7c-d8f64afa7e65";
                    if (this.headstate == true) {
                        var filter = "id in (select relateid from dc_d_fangwu where instr(',' || txbh || ',', ',' || '" + row + "' || ',')>0) ";
                    } else {
                        var filter = " instr(',' || txbh || ',', ',' || '" + row + "' || ',')>0 ";
                    }
                    console.log("查询开始", row);
                    $.ajax({
                        url: action,
                        data: signMD5({//转换编码
                            _method: "component.getListData", // 方法名
                            bizObj: "DC_M_HUZHU",//查询对象表名称
                            service: "selectMore",//查多方法
                            fields: "*", //查询字段
                            filter: filter //过滤条件
                        }),
                        cache: true,//避免自动加上时间戳参数，_=?
                        async: true,//设置是否异步
                        dataType: "jsonp",
                        success: function (response) {
                            console.log(response)
                            if (response.datas.length > 0) {
                                _this.activeName = response.datas[0].ID
                                _this.headmessage = response.datas
                                _this.huzhuxinxi = response.datas[0]
                                _this.FMTP = response.datas[0].FMTP
                                _this.Details = true
                                _this.housemessage(response.datas[0].ID)
                                //获取用户图片地址
                                $.ajax({
                                    url: action,
                                    data: signMD5({
                                        _method: "streamSupportService.getAttachmentInfos",
                                        _param: '[{ "fieldToken":' + response.datas[0].FMTP + '}]'
                                    }),
                                    cache: true,//避免自动加上时间戳参数，_=?
                                    async: true,//设置是否异步
                                    dataType: "jsonp",
                                    success: function (row) {
                                        if (+row.attachments.length != 0) {
                                            _this.householdIMG = false;
                                        } else {
                                            _this.householdIMG = true;
                                        }
                                        _this.information = window.location.href.split("/")[0] + "//" + window.location.href.split("/")[2] + "/systemcenter/servlet/StreamSupportAction.cmd?type=customerDownloadService&FixJSON={%27_method%27:%27streamSupportService.getAttachment%27,%27_param%27:{attachmentId:" + row.attachments[0].fileId + "}}&thumb=”+true OR false"
                                    }
                                });

                            } else {
                                _this.$message('当前房屋无关联');
                                _this.Details = false;
                            }
                        }
                    });

                },
                //用户打点
                updateOracleHUZU: function (row, func) {
                    var _this = this;
                    if (_this.FLAG == "HUZHU") {
                        infoFlag = "1"
                    } else {
                        infoFlag = ''
                    }
                    data = {
                        HZID: _this.hideTooID,//传入所选户主ID
                        TXBH: shuzu,//传入打点编号，支持多个值以英文逗号分隔
                        SS: "",//判断是否是实施阶段，传1代表实施阶段，否则省略该参数。
                        isHZ: infoFlag//判断是否是户主打点，传1代表户主打点，否则省略该参数。
                    }
                    $.ajax({
                        url: ajaxUrl,
                        data: signMD5({
                            _method: "DC_M_HUZHU.changeTxbhByHzid",
                            HZID: _this.hideTooID,//传入所选户主ID
                            TXBH: row,//传入打点编号，支持多个值以英文逗号分隔
                            SS: "",//判断是否是实施阶段，传1代表实施阶段，否则省略该参数。
                            isHZ: infoFlag//判断是否是户主打点，传1代表户主打点，否则省略该参数。
                        }),
                        async: false,//设置是否异步
                        cache: true,//避免自动加上时间戳参数，_=
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (response) {
                            if (response.FixError == "不具有修改权限！") {
                                _this.zhuangtai = false;
                                _this.bianhaoif = false;
                                _this.$message(response.FixError);
                            } else {

                                _this.changeclick(_this.yeval)

                                if (MAPhuzu) {
                                    map.removeLayer(MAPhuzu);
                                }
                                if (MAPtu) {
                                    map.removeLayer(MAPtu);
                                }
                                MAPhuzu = new L.featureGroup().addTo(map);
                                MAPtu = new L.featureGroup().addTo(map);

                                housearr = []
                                markers.remove()
                                var icon = L.icon({
                                    iconSize: [30, 30],
                                    iconAnchor: [0, 0],
                                    iconUrl: "./img/add.png",
                                });
                                point = [0, 0];
                                markers = new L.marker(point, {
                                    icon: icon,
                                }).addTo(map);
                                HUZUTU.remove()
                                markers.on('click', markerClickss);
                                HUZUTU = new L.featureGroup().addTo(map);
                                if (func) func();
                                _this.$message('添加成功');
                            }

                        }
                    });

                },
                //房屋与土地进行绑定
                updateOracleHouseHost: function (row) {
                    console.log(row)
                    var _this = this
                    var strLand = row
                    var infoFlag = (_this.FLAG == "HUZHU" ? 0 : 1);
                    if (this.headstate == true) {
                        ass = _this.GDBH + "-" + _this.hideTooindex
                    } else {
                        ass = _this.GDBH
                    }
                    data = {
                        _method: "DC_D_FANGWU.changeTxbhByFwbh",
                        id: _this.hideTooID,
                        landids: strLand,
                        fwbh: ass
                    }
                    console.log(data)
                    $.ajax({
                        url: ajaxUrl,
                        type: 'post',
                        data: signMD5({
                            _method: "DC_D_FANGWU.changeTxbhByFwbh",
                            id: _this.hideTooID,
                            landids: strLand,
                            fwbh: ass
                        }),//传入的参数?
                        cache: true,//避免自动加上时间戳参数，_=
                        async: false,//设置是否异步
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (row) {
                            if (row.FixError == "不具有修改权限！") {
                                _this.zhuangtai = false;
                                _this.bianhaoif = false;
                                housearr = []
                                HeadQuantity = [];
                                screenHUZHU = [];
                                shuzu = [];
                                shuzuweizi = [];
                                _this.$message(row.FixError);
                            } else {
                                HUZUTU.clearLayers();
                                MAPhouse.remove()
                                setTimeout(function () {
                                    var url = tileLayer
                                    MAPhouse = new L.tileLayer.wms(url, {
                                        layers: 'xatree:mapconfig_building',
                                        crs: L.CRS.EPSG4326,
                                        serverType: new Date().getTime() + "",
                                        format: 'image/png',
                                        minZoom: 11,
                                        maxZoom: 21,
                                        transparent: true
                                    }).addTo(map);
                                }, 500);
                                // wmsmMps()
                                MAPtu.remove()
                                MAPtu = new L.featureGroup().addTo(map);
                                _this.changeclick(_this.yeval)
                                _this.handleClick(_this.arr_row)
                                _this.$message('添加成功');
                                loadBuildingEmptyData()
                                markers.remove()
                                var icon = L.icon({
                                    iconSize: [30, 30],
                                    iconAnchor: [0, 0],
                                    iconUrl: "./img/add.png",
                                });
                                point = [0, 0];
                                markers = new L.marker(point, {
                                    icon: icon,
                                }).addTo(map);
                                housearr = []
                                HeadQuantity = [];
                                screenHUZHU = [];
                                shuzu = [];
                                shuzuweizi = [];
                            }



                        }
                    });
                },
                //户与土地进行绑定
                additionhouse: function (row, func) {
                    var _this = this
                    var infoFlag = (_this.FLAG == "HUZHU" ? 0 : 1);
                    var data = {
                        _method: "DC_D_FANGWU.insertIntoFWByHzid",
                        qsrid: _this.serialID,
                        flag: infoFlag,
                        flag_ss: 1,
                        fws: "[{'landids'='" + row + "','fwbh'='" + _this.imgGDBH + "-" + _this.imgindex + "'}]"
                    }
                    $.ajax({
                        url: ajaxUrl,
                        type: 'post',
                        data: signMD5({
                            _method: "DC_D_FANGWU.insertIntoFWByHzid",
                            qsrid: _this.serialID,
                            flag: infoFlag,
                            flag_ss: 1,
                            fws: "[{'landids'='" + row + "','fwbh'='" + _this.imgGDBH + "-" + _this.imgindex + "'}]"
                        }),//传入的参数
                        cache: true,//避免自动加上时间戳参数，_=?
                        async: false,//设置是否异步
                        dataType: "jsonp",//跨域必须这么设置
                        success: function (response) {
                            console.log(response)
                            if (response.datas == "没有权限或该行政区划已锁定！") {
                                _this.statubar = false;
                                _this.$message("没有权限或该行政区划已锁定！")

                            } else {
                                _this.statubar = true;
                                _this.$message('添加成功');
                            }
                            _this.changeclick(_this.yeval)
                            _this.handleClick(_this.arr_row)
                            _this.imgadd = false
                            _this.bianhaoif = false;
                            if (func) func();
                        },
                        error: function (response) {

                        }
                    });
                },
                //根据姓名进行赛选
                figure_inquire: function () {
                    var _this = this
                    console.log(this.villages)
                    if (this.villages == "") {
                        _this.filterstr = "HZXM like '%" + String(_this.input) + "%'";
                    } else {
                        _this.filterstr = "HZXM like '%" + String(_this.input) + "%' and xzqh like '" + "%" + _this.villages + "%'";
                    }

                    this.page_data(1)
                    this.data_page()

                },
                //清除赛选
                figure_btn: function () {
                    console.log(this.cascader_s)
                    this.cascader_s = '';
                    this.villages = ""
                    this.input = ""
                    // this.options = []
                    this.clearabless = true;
                    this.filterstr = "1=1";
                    // this.region()
                    this.page_data(1)
                    this.data_page()
                },
                //点击户主姓名实现定位
                HUZUname: function (row) {
                    var _this = this;
                    this.Details = false;
                    var url = MAPURL + 'map/buildings?householderid=' + row.ID
                    $.ajax({
                        type: 'get',
                        url: url,
                        contentType: 'application/json',
                        dataType: 'json',
                        success: function (e) {
                            console.log(e)
                            MAPtu.remove()
                            MAPtu = new L.featureGroup().addTo(map);
                            if (e.length > 0) {

                                var x = e[0].WKT.split("(")[2].split(")")[0].split(",")[1].split(" ")[0];
                                var y = e[0].WKT.split("(")[2].split(")")[0].split(",")[1].split(" ")[1];
                                var latlngs = [y, x];
                                var xianshiarr = []
                                for (var i = 0; i < e.length; i++) {
                                    var latlngss = [];
                                    for (var q = 0; q < e[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                        // e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                        var x = parseFloat(e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                        var y = parseFloat(e[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                        latlngss.push([y, x]);
                                        xianshiarr.push([y, x]);
                                    }

                                  //根据不同身份来显示不同颜色房屋
                                    if (e[i].Status == 0) {
                                        lineq = new L.polygon(latlngss, { color: 'red', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    } else if (e[i].Status == 1) {
                                        lineq = new L.polygon(latlngss, { color: 'green', fillColor: 'yellow', opacity: 1, fillOpacity: 0.8, weight: 1, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    } else if (e[i].Status == 2) {
                                        lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    } else if (e[i].Status == 3) {
                                        lineq = new L.polygon(latlngss, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    } else if (e[i].Status == 4) {
                                        lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    } else if (e[i].Status == 5) {
                                        lineq = new L.polygon(latlngss, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0, id: e[i].ID, WKT: e[i].WKT, arr: e[i] })
                                            .addTo(MAPtu);
                                    }
                                    lineq.on('click', a1);
                                    lineq.bringToFront()

                                }

                                // var polyline = L.polyline(xianshiarr, {color: 'red',opacity:0}).addTo(MAPtu);
                                // line.on('click', onMapClicmarkers);
                                //获取当前屏幕范围来加载当前的房屋
                                map.setView(latlngs, 17);
                                // map.fitBounds(polyline.getBounds());
                                var leftdown = map.getBounds().getSouthWest().lng + " " + map.getBounds().getSouthWest().lat;
                                //右上角坐标（东北方向）
                                var rightop = map.getBounds().getNorthEast().lng + " " + map.getBounds().getNorthEast().lat;
                                //左上角：西北方
                                var leftop = map.getBounds().getNorthWest().lng + " " + map.getBounds().getNorthWest().lat;
                                //右下角：东南方
                                var righdown = map.getBounds().getSouthEast().lng + " " + map.getBounds().getSouthEast().lat;
                                var wts = []
                                wts.push(leftdown)
                                wts.push(rightop)
                                wts.push(leftop)
                                wts.push(righdown)
                                var arrmap = JSON.stringify(wts);

                                var bianjie = "POLYGON(" + "(" + leftdown + "," + righdown + "," + rightop + "," + leftop + "," + leftdown + ")" + ")";
                                var url = MAPURL + 'map/buildings?mapid=' + mapid + "&" + "bbox=" + bianjie
                                console.log(url)
                                var URL = MAPURL + "map/pointbuildings?mapid=" + mapid + "&" + "bbox=" + bianjie
                                //显示当前屏幕范围的make点
                                $.ajax({
                                    type: 'get',
                                    url: URL,
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    success: function (row) {

                                        for (var i = 0; i < row.length; i++) {
                                            if (row[i].Status == 3) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            } else if (row[i].Status == 4) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            } else if (row[i].Status == 5) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            } else if (row[i].Status == 0) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            } else if (row[i].Status == 1) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            } else if (row[i].Status == 2) {
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [20, 20],
                                                    iconUrl: "./img/beijing.png",
                                                });
                                            }
                                            var y = row[i].WKT.split("(")[1].split(")")[0].split(" ")[0];
                                            var x = row[i].WKT.split("(")[1].split(")")[0].split(" ")[1];
                                            console.log(row[i].WKT.split("(")[1].split(")")[0])
                                            point = [x, y]
                                            marker = new L.marker(point, {
                                                icon: icon,
                                                arr: row[i],

                                            }).addTo(map);
                                            marker.on('click', markerClick);
                                        }
                                    },
                                    fail: function (d) {
                                        VueObj.buildingLoading = false;
                                    }
                                });
                                //显示当前范围的房屋
                                $.ajax({
                                    type: 'get',
                                    url: url,
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    success: function (row) {
                                        console.log(row)
                                        for (var i = 0; i < row.length; i++) {
                                            var latlngs = []
                                            for (var q = 0; q < row[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                                row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                                var x = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                                var y = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                                latlngs.push([y, x]);
                                            }

                                            if (row[i].Status == 0) {
                                                line = new L.polygon(latlngs, { color: 'red', fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            } else if (row[i].Status == 1) {
                                                line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            } else if (row[i].Status == 2) {
                                                line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            } else if (row[i].Status == 3) {
                                                line = new L.polygon(latlngs, { color: 'red', noClip: true, fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            } else if (row[i].Status == 4) {
                                                line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            } else if (row[i].Status == 5) {
                                                line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                    .addTo(MAPhuzu);
                                            }


                                            line.on('click', onMapClick);
                                            line.bringToBack()
                                        }

                                    },
                                    fail: function (d) {
                                        VueObj.buildingLoading = false;
                                    }
                                });
                            } else {

                                _this.$message('当前房屋无关联');
                            }


                        },
                        fail: function (d) {
                            VueObj.buildingLoading = false;
                        }
                    });

                },
                userLogin: function (data2) {
                },
                //点击确定，添加绑定
                confirmmodify: function () {
                    var _this = this
                    var latlngs = xiugaitucen._latlngs;
                    var arr = []
                    for (var i = 0; i < latlngs[0].length; i++) {
                        arr.push(latlngs[0][i].lng + " " + latlngs[0][i].lat)
                    }
                    console.log(arr)
                    var op = "";
                    for (var q = 0; q < arr.length; q++) {
                        op += arr[q] + ",";
                    }

                    var bianjie = "POLYGON(" + "(" + op + arr[0] + ")" + ")";
                    var data = {
                        ID: LayerID,
                        MCID: treeTypes,
                        WKT: bianjie,
                    };

                    var url = MAPURL + 'map/buildingdataedit';
                    $.ajax({
                        url: url,
                        type: 'post',
                        contentType: 'application/json',
                        dataType: 'json',
                        data: JSON.stringify(data),
                        success: function (ret) {
                            console.log(ret)
                            this.addmap = true;
                            this.addMAP = false;
                            if (ret.code == 1) {
                                HUZUTU.remove()
                                HUZUTU = new L.featureGroup().addTo(map);
                                _this.isShowToolBar = false;
                                VueObj.$message('添加成功');
                                MAPhouse.remove()
                                setTimeout(function () {
                                    var url = tileLayer
                                    MAPhouse = new L.tileLayer.wms(url, {
                                        layers: 'xatree:mapconfig_building',
                                        crs: L.CRS.EPSG4326,
                                        serverType: new Date().getTime() + "",
                                        format: 'image/png',
                                        minZoom: 11,
                                        maxZoom: 21,
                                        transparent: true
                                    }).addTo(map);
                                }, 500);
                                loadBuildingEmptyData()////加载空房屋图层
                            } else {
                                alert("添加失败")
                            }
                        }
                    });
                    xiugaitucen.disableEdit();
                    document.getElementsByClassName("xiugaikuang")[0].style.color = "black"
                },
                Modifylayer: function () {
                    document.getElementsByClassName("xiugaikuang")[0].style.color = "#409EFF"
                    xiugaitucen.enableEdit();
                },
                //获取当前地理位置
                automatic: function () {
                    //通过接口获取地理位置 用户可能没有上报过数据？
                    var _this = this
                    this.PositioningIf = false;
                    $.ajax({
                        url: ajaxUrl,
                        type: 'post',
                        data: signMD5({
                            _method: "FIX_DAILY_MAKESHIFT_TRACK.selectUserLastLocation",
                        }),//传入的参数
                        cache: true,
                        async: true,
                        dataType: "jsonp",
                        success: function (res) {
                            console.log(res);
                            
                            if(res && res.datas && res.datas.length){
                                var lat= res.datas[0].CORLAT
                                    ,lng = res.datas[0].CORLNG
                                    ,latlngs = [lat,lng]
                                    
                                markers.remove()
                                map.setView(latlngs, 17);
                                var icon = L.icon({
                                    iconSize: [23, 37],
                                    iconAnchor: [23, 37],
                                    iconUrl: "./img/weizi.png",
                                });
                                point = [0, 0];
                                markers = new L.marker(latlngs, {
                                    icon: icon,
                                }).addTo(MAPhuzu);
                                _this.PositioningIf = true;
                            }else{
                                _this.getLocateByBMap()
                            }
                        },
                        error:function(err){
                            console.log(err)
                            _this.getLocateByBMap()
                        }
                    });
                    tlocation()
                },
                getLocateByBMap:function(){
                    var _this = this
                    try {
                        window.external.notify("location");
                    } catch (e) {
                        var geolocation = new BMap.Geolocation();
                        var gc = new BMap.Geocoder();//创建地理编码器// 开启SDK辅助定位
                        geolocation.enableSDKLocation();
                        geolocation.getCurrentPosition(function (r) {
                            if (this.getStatus() == BMAP_STATUS_SUCCESS) {
                                var mk = new BMap.Marker(r.point);
                                console.log(r.point);
                                
                                bd09togcj02(r.point.lng, r.point.lat)
                            }
                            else {
                                _this.$message('获取定位信息失败，请开启权限');
                            }
                        }, { enableHighAccuracy: true })

                        
                    }
                    //tlocation()
                },
                DeleteLayerIf: function () {
                    this.centerDialogs = true
                },
                //删除绑定房屋
                DeleteLayer: function () {
                    var _this = this
                    var url = MAPURL + 'map/singlebuildingdelete?id=' + LayerID;
                    $.ajax({
                        url: url,
                        type: 'post',
                        contentType: 'application/json',
                        dataType: 'json',
                        success: function (ret) {
                            console.log(ret)
                            this.addmap = true;
                            this.addMAP = false;
                            if (ret.code == 1) {
                                HUZUTU.remove()
                                HUZUTU = new L.featureGroup().addTo(map);
                                MAPtu.remove()
                                MAPtu = new L.featureGroup().addTo(map);

                                VueObj.$message('删除成功');
                                _this.isShowToolBar = false;
                                _this.centerDialogs = false;
                                MAPhouse.remove()
                                setTimeout(function () {
                                    var url = tileLayer
                                    MAPhouse = new L.tileLayer.wms(url, {
                                        layers: 'xatree:mapconfig_building',
                                        crs: L.CRS.EPSG4326,
                                        serverType: new Date().getTime() + "",
                                        format: 'image/png',
                                        minZoom: 11,
                                        maxZoom: 21,
                                        transparent: true
                                    }).addTo(map);
                                }, 500);
                                loadBuildingEmptyData()////加载空房屋图层
                            } else {
                                alert("删除失败")
                            }
                        }
                    });
                }
            },

            mounted: function () {
                var winHeight = window.innerHeight
                //根据屏幕大小获取用户列表范围
                if (winHeight < 510) {
                    this.pageSize = 5;
                    this.divlength = 405
                } else {
                    this.pageSize = 8;
                    this.divlength = 540
                }
                var _this = this
                //获取当前域名
                var html = window.location.href.split("/")[0] + "//" + window.location.href.split("/")[2]
                
                //判断打点方式
                if (onlineUserDDFS == 1) {
                    this.getDotWay = true;
                    this.addkuang = true
                } else if (onlineUserDDFS == 0) {
                    this.getDotWay = false;
                    this.adddian = true
                }
                //判断显示方式
                if (onlineUserDDLX == 0) {
                    this.headstate = false
                } else if (onlineUserDDLX == 1) {
                    this.headstate = true
                }
                //判读是否有实测数据
                if (MapSurvey == 0) {
                    this.MapSurvey = true;
                } else {
                    this.MapSurvey = false;
                }
                var url = MAPURL + 'map/mapconfigs?proid=' + aww;
                
                //获取项目信息
                $.ajax({
                    url: url,
                    type: 'get',
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                        Zoom = data[0].Level
                        Center[0] = data[0].CY;
                        Center[1] = data[0].CX;
                        treeTypes = data[0].ID;
                        tileLayer = GeoserverUrl + "?cql_filter=MCID='" + treeTypes + "'"
                        mapid = data[0].ID;
                        _this.mapid = data[0].ID;
                        _this.loading = false;
                        document.getElementsByClassName("base_divss")[0].style.height = 0 + "px";
                        mapscope = data[0].BaseMaps;
                        initMap();
                        var icon = L.icon({
                            iconSize: [30, 30],
                            iconAnchor: [0, 0],
                            iconUrl: "./img/add.png",
                        });
                        point = [0, 0];
                        markers = new L.marker(point, {
                            icon: icon,
                        }).addTo(map);
                        markers.on('click', markerClickss);
                        map.on("movestart", onDouble);

                        function onDouble(ev) {
                            if (map.getZoom() > 15) {
                                //根据成绩获取土块
                                if (_this.village == true) {
                                    //左下角坐标
                                    var leftdown = map.getBounds().getSouthWest().lng + " " + map.getBounds().getSouthWest().lat;
                                    //右上角坐标（东北方向）
                                    var rightop = map.getBounds().getNorthEast().lng + " " + map.getBounds().getNorthEast().lat;
                                    //左上角：西北方
                                    var leftop = map.getBounds().getNorthWest().lng + " " + map.getBounds().getNorthWest().lat;
                                    //右下角：东南方
                                    var righdown = map.getBounds().getSouthEast().lng + " " + map.getBounds().getSouthEast().lat;
                                    var wts = []
                                    wts.push(leftdown)
                                    wts.push(rightop)
                                    wts.push(leftop)
                                    wts.push(righdown)
                                    var arrmap = JSON.stringify(wts);

                                    var bianjie = "POLYGON(" + "(" + leftdown + "," + righdown + "," + rightop + "," + leftop + "," + leftdown + ")" + ")";
                                    // var bianjie="POLYGON((118.91189575195312 29.0313720703125,118.91326904296875 29.0313720703125,118.91326904296875 29.032745361328125,118.91189575195312 29.032745361328125,118.91189575195312 29.0313720703125))"
                                    var url = MAPURL + 'map/buildings?mapid=' + mapid + "&" + "bbox=" + bianjie
                                    console.log(url)
                                    var URL = MAPURL + "map/pointbuildings?mapid=" + mapid + "&" + "bbox=" + bianjie
                                    //根据层级获取make点
                                    $.ajax({
                                        type: 'get',
                                        url: URL,
                                        contentType: 'application/json',
                                        dataType: 'json',
                                        success: function (row) {
                                            console.log(row)
                                            for (var i = 0; i < row.length; i++) {
                                                if (row[i].Status == 3) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                } else if (row[i].Status == 4) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                } else if (row[i].Status == 5) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                } else if (row[i].Status == 0) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                } else if (row[i].Status == 1) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                } else if (row[i].Status == 2) {
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [20, 20],
                                                        iconUrl: "./img/beijing.png",
                                                    });
                                                }
                                                var y = row[i].WKT.split("(")[1].split(")")[0].split(" ")[0];
                                                var x = row[i].WKT.split("(")[1].split(")")[0].split(" ")[1];
                                                console.log(row[i].WKT.split("(")[1].split(")")[0])
                                                point = [x, y]
                                                marker = new L.marker(point, {
                                                    icon: icon,
                                                    arr: row[i],

                                                }).addTo(map);
                                                marker.on('click', markerClick);
                                            }
                                        },
                                        fail: function (d) {
                                            VueObj.buildingLoading = false;
                                        }
                                    });
                                    //根据层级获取地块
                                    $.ajax({
                                        type: 'get',
                                        url: url,
                                        contentType: 'application/json',
                                        dataType: 'json',
                                        success: function (row) {
                                            console.log(row)
                                            for (var i = 0; i < row.length; i++) {

                                                var latlngs = []
                                                for (var q = 0; q < row[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                                                    row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                                                    var x = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                                                    var y = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                                                    latlngs.push([y, x]);
                                                }
                                               //根据不同状态显示不同颜色
                                                if (row[i].Status == 0) {
                                                    line = new L.polygon(latlngs, { color: 'red', fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                } else if (row[i].Status == 1) {
                                                    line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                } else if (row[i].Status == 2) {
                                                    line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                } else if (row[i].Status == 3) {
                                                    line = new L.polygon(latlngs, { color: 'red', noClip: true, fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                } else if (row[i].Status == 4) {
                                                    line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                } else if (row[i].Status == 5) {
                                                    line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                                        .addTo(MAPhuzu);
                                                }


                                                line.on('click', onMapClick);
                                                // line.on('dblclick', onDoubleClick);//双击地图

                                                line.bringToBack()
                                            }
                                            console.log(line)
                                        },
                                        fail: function (d) {
                                            VueObj.buildingLoading = false;
                                        }
                                    });
                                } else {
                                    loadVillage()
                                }
                            }
                        }
                    }
                });


                this.region()
                this.page_data(1)
                this.data_page()
                this.getHostInfo(167)
                this.getHostInfo(168)
            },
            watch: {
                input: function () {
                }
            },
        })
        //点击加载的村落
        function onMapClickvillage(e) {
            var latlngs = []
            HUZUTU.remove()
            HUZUTU = new L.featureGroup().addTo(map);
            for (var q = 0; q < e.target.options.arr.WKT.split("(")[3].split(")")[0].split(",").length; q++) {
                var x = parseFloat(e.target.options.arr.WKT.split("(")[3].split(")")[0].split(",")[q].split(" ")[0]);
                var y = parseFloat(e.target.options.arr.WKT.split("(")[3].split(")")[0].split(",")[q].split(" ")[1]);
                latlngs.push([y, x]);
            }

            linez = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2 })
                .addTo(HUZUTU);
            alert("DKBH=" + e.target.options.arr.DKBH + "......." + "ID=" + e.target.options.arr.ID)
        }
        //加载地图范围加载矢量村落
        function loadVillage() {
            MAPvillage.remove()
            MAPvillage = new L.featureGroup().addTo(map);
            var leftdown = map.getBounds().getSouthWest().lng + " " + map.getBounds().getSouthWest().lat;
            //右上角坐标（东北方向）
            var rightop = map.getBounds().getNorthEast().lng + " " + map.getBounds().getNorthEast().lat;
            //左上角：西北方
            var leftop = map.getBounds().getNorthWest().lng + " " + map.getBounds().getNorthWest().lat;
            //右下角：东南方
            var righdown = map.getBounds().getSouthEast().lng + " " + map.getBounds().getSouthEast().lat;
            var bianjie = "POLYGON(" + "(" + leftdown + "," + righdown + "," + rightop + "," + leftop + "," + leftdown + ")" + ")"
            var mapids = ""
            var URL = MAPURL + "map/dks?mapid=" + mapids + "&" + "bbox=" + bianjie;
            $.ajax({
                url: URL,
                type: 'get',
                contentType: 'application/json',
                dataType: 'json',
                success: function (row) {
                    for (var i = 0; i < row.length; i++) {
                        var latlngs = []
                        for (var q = 0; q < row[i].WKT.split("(")[3].split(")")[0].split(",").length; q++) {
                            var x = parseFloat(row[i].WKT.split("(")[3].split(")")[0].split(",")[q].split(" ")[0]);
                            var y = parseFloat(row[i].WKT.split("(")[3].split(")")[0].split(",")[q].split(" ")[1]);
                            latlngs.push([y, x]);
                        }
                        line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'red', opacity: 0.8, fillOpacity: 0.5, weight: 1, arr: row[i] })
                            .addTo(MAPvillage);
                        line.on('click', onMapClickvillage);
                        line.bringToFront()
                    }
                }
            });

        }

        ///按照地图范围加载房屋单体空数据
        function loadBuildingEmptyData() {
            MAPhuzu.remove()
            MAPhuzu = new L.featureGroup().addTo(map);
            var leftdown = map.getBounds().getSouthWest().lng + " " + map.getBounds().getSouthWest().lat;
            //右上角坐标（东北方向）
            var rightop = map.getBounds().getNorthEast().lng + " " + map.getBounds().getNorthEast().lat;
            //左上角：西北方
            var leftop = map.getBounds().getNorthWest().lng + " " + map.getBounds().getNorthWest().lat;
            //右下角：东南方
            var righdown = map.getBounds().getSouthEast().lng + " " + map.getBounds().getSouthEast().lat;
            var wts = []
            wts.push(leftdown)
            wts.push(rightop)
            wts.push(leftop)
            wts.push(righdown)
            var arrmap = JSON.stringify(wts);

            var bianjie = "POLYGON(" + "(" + leftdown + "," + righdown + "," + rightop + "," + leftop + "," + leftdown + ")" + ")";
            //加载点房屋
            var URL = MAPURL + "map/pointbuildings?mapid=" + mapid + "&" + "bbox=" + bianjie + "&radom=" + Date.parse(new Date());
            $.ajax({
                type: 'get',
                url: URL,
                contentType: 'application/json',
                dataType: 'json',
                success: function (row) {

                    for (var i = 0; i < row.length; i++) {
                        if (row[i].Status == 3) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        } else if (row[i].Status == 4) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        } else if (row[i].Status == 5) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        } else if (row[i].Status == 0) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        } else if (row[i].Status == 1) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        } else if (row[i].Status == 2) {
                            var icon = L.icon({
                                iconSize: [30, 30],
                                iconAnchor: [20, 20],
                                iconUrl: "./img/beijing.png",
                            });
                        }
                        var y = row[i].WKT.split("(")[1].split(")")[0].split(" ")[0];
                        var x = row[i].WKT.split("(")[1].split(")")[0].split(" ")[1];
                        point = [x, y]
                        marker = new L.marker(point, {
                            icon: icon,
                            arr: row[i],

                        }).addTo(HUZUTU);
                        marker.on('click', markerClick);
                    }
                },
                fail: function (d) {
                    VueObj.buildingLoading = false;
                }
            });
            //加载面房屋
            var url = MAPURL + 'map/buildings?mapid=' + mapid + "&" + "bbox=" + bianjie + "&radom=" + Date.parse(new Date());
            $.ajax({
                type: 'get',
                url: url,
                contentType: 'application/json',
                dataType: 'json',
                success: function (row) {
                    for (var i = 0; i < row.length; i++) {
                        var latlngs = []
                        for (var q = 0; q < row[i].WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                            row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                            var x = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                            var y = parseFloat(row[i].WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                            latlngs.push([y, x]);
                        }

                        if (row[i].Status == 0) {
                            line = new L.polygon(latlngs, { color: 'red', fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        } else if (row[i].Status == 1) {
                            line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        } else if (row[i].Status == 2) {
                            line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        } else if (row[i].Status == 3) {
                            line = new L.polygon(latlngs, { color: 'red', noClip: true, fillColor: 'red', opacity: 0, fillOpacity: 0, weight: 0.2, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        } else if (row[i].Status == 4) {
                            line = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        } else if (row[i].Status == 5) {
                            line = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0, fillOpacity: 0, weight: 0, id: row[i].ID, WKT: row[i].WKT, arr: row[i] })
                                .addTo(MAPhuzu);
                        }


                        line.on('click', onMapClick);
                        line.bringToFront()
                    }

                },
                fail: function (d) {
                    VueObj.buildingLoading = false;
                }
            });
        }

        var shuzu = []
        //点击对号图标
        function onMapClicmarkers(e) {

            // e.target.removeFrom(map)
            if (HeadQuantity.length > 1) {

                for (var i = 0; i < HeadQuantity.length; i++) {
                    if (e.target.options.arr.ID != HeadQuantity[i].ID) {
                        screenHUZHU.push(HeadQuantity[i])
                    }
                    if (e.target.options.arr.ID != shuzu[i]) {
                        arrayHUZHU.push(shuzu[i])
                    }
                }

                HeadQuantity = screenHUZHU
                shuzu = arrayHUZHU
            } else {
                HeadQuantity = [];
                screenHUZHU = [];
                shuzu = []
            }

        }
        //点击已选地块的方法
        function onMapClickss(e) {
            e.target.remove()
            console.log(e)
            if (shuzu.length > 1) {

                if (HeadQuantity.length > 1) {
                    screenHUZHU = []
                    arrayHUZHU = []
                    for (var i = 0; i < 10; i++) {
                        // console.log(i)
                        if (HeadQuantity[i] != undefined) {


                            if (e.target.options.arr.ID != HeadQuantity[i].ID) {
                                screenHUZHU.push(HeadQuantity[i])
                            }
                            if (e.target.options.arr.ID != shuzu[i]) {
                                arrayHUZHU.push(shuzu[i])
                            }
                        }
                    }

                    HeadQuantity = screenHUZHU
                    shuzu = arrayHUZHU
                } else {
                    arrayHUZHU = []
                    console.log(shuzu)
                    console.log(e.target.options.arr.ID)
                    for (var a = 0; a < 10; a++) {
                        if (shuzu[a] != undefined) {
                            if (e.target.options.arr.ID != shuzu[a])
                                arrayHUZHU.push(shuzu[a])
                        }
                    }
                    shuzu = arrayHUZHU
                    console.log(arrayHUZHU)
                    console.log(shuzu)
                }


            } else {

                HeadQuantity = [];
                screenHUZHU = [];
                shuzu = [];

                markers.remove()
                var icon = L.icon({
                    iconSize: [30, 30],
                    iconAnchor: [0, 0],
                    iconUrl: "./img/add.png",
                });
                point = [0, 0];
                markers = new L.marker(point, {
                    icon: icon,
                }).addTo(map);
                markers.on('click', markerClickss);
            }
            var latlngss = [];
            for (var q = 0; q < shuzuweizi.length; q++) {
                if (shuzuweizi[q].ID == shuzu[0]) {
                    var x = shuzuweizi[q].WKT.split("(")[2].split(")")[0].split(",")[0].split(" ")[0];
                    var y = shuzuweizi[q].WKT.split("(")[2].split(")")[0].split(",")[0].split(" ")[1];
                    latlngss.push([y, x]);
                }
            }
            point = [latlngss[0][0], latlngss[0][1]];
            markers.setLatLng(point)

        }
        //点击对号添加房屋
        function markerClickss() {
            if (VueObj.headstate == true) {

                //判断是否是单个房屋
                if (VueObj.modifier == false) {
                    var url = MAPURL + 'map/buildingedit';
                    var str = ""
                    for (var a = 0; a < shuzu.length; a++) {
                        str += shuzu[a] + ","
                    }
                    if (str.length > 0) {
                        str = str.substr(0, str.length - 1);
                    }
                    VueObj.updateOracleHouseHost(str);
                    for (var i = 0; i < HeadQuantity.length; i++) {
                        $.ajax({
                            url: url,
                            type: 'post',
                            contentType: 'application/json',
                            dataType: 'json',
                            data: JSON.stringify(HeadQuantity[i]),
                            success: function (ret) {
                                console.log(ret)

                            }
                        });
                    }
                } else {
                    arr = [];
                    for (var i = 0; i < VueObj.TXBHss.split(",").length; i++) {
                        arr.push(VueObj.TXBHss.split(",")[i])
                    }
                    var str = ""
                    for (var a = 0; a < arr.length; a++) {
                        str += arr[a] + ","
                    }
                    if (str.length > 0) {
                        str = str.substr(0, str.length - 1);
                    }
                    var obj = ""
                    for (var i = 0; i < shuzu.length; i++) {
                        obj += shuzu[i] + ","
                    }
                    console.log(obj)
                    if (obj.length > 0) {
                        obj = obj.substr(0, obj.length - 1);
                    }
                    var ass = VueObj.TXBHss.split(",");
                    var dizi = MAPURL + 'map/rebindbuilding';
                    var datashu = {
                        HouseHolder: VueObj.serialXZXM,
                        HouseHolderID: VueObj.serialID,
                        OldBuildings: arr,
                        NewBuildings: shuzu,

                    };
                    console.log(datashu)
                    $.ajax({
                        url: dizi,
                        type: 'post',
                        contentType: 'application/json',
                        dataType: 'json',
                        data: JSON.stringify(datashu),
                        success: function (ret) {
                            console.log(ret)
                        }
                    });
                    VueObj.modifierHouse = false
                    VueObj.updateOracleHouseHost(obj);
                    console.log(shuzu)

                }
            } else {
                if (VueObj.modifier == false) {
                    var url = MAPURL + 'map/buildingedit';
                    var str = ""
                    for (var a = 0; a < shuzu.length; a++) {
                        str += shuzu[a] + ","
                    }
                    if (str.length > 0) {
                        str = str.substr(0, str.length - 1);
                    }
                    VueObj.updateOracleHUZU(str, function () {
                        if (VueObj.zhuangtai == true) {
                            for (var i = 0; i < HeadQuantity.length; i++) {
                                $.ajax({
                                    url: url,
                                    type: 'post',
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    data: JSON.stringify(HeadQuantity[i]),
                                    success: function (ret) {

                                        MAPhouse.remove()
                                        //    setTimeout(function () {
                                        var url = tileLayer
                                        MAPhouse = new L.tileLayer.wms(url, {
                                            layers: 'xatree:mapconfig_building',
                                            crs: L.CRS.EPSG4326,
                                            serverType: new Date().getTime() + "",
                                            format: 'image/png',
                                            minZoom: 11,
                                            maxZoom: 21,
                                            transparent: true
                                        }).addTo(map);
                                        // }, 100);
                                        shuzu = []
                                        VueObj.bianhaoif = false;
                                        HUZUTU.remove()
                                        markers.remove()
                                        var icon = L.icon({
                                            iconSize: [30, 30],
                                            iconAnchor: [0, 0],
                                            iconUrl: "./img/add.png",
                                        });
                                        point = [0, 0];
                                        markers = new L.marker(point, {
                                            icon: icon,
                                        }).addTo(map);
                                        markers.on('click', markerClickss);
                                        HUZUTU = new L.featureGroup().addTo(map);
                                        loadBuildingEmptyData(); //加载空房屋图层
                                    }
                                });
                            }
                        }
                    });


                } else {
                    for (var q = 0; q < xiugai.length; q++) {
                        shuzu.push(xiugai[q])
                    }
                    console.log(VueObj.serialXZXM)
                    var str = ""
                    for (var a = 0; a < shuzu.length; a++) {
                        str += shuzu[a] + ","
                    }
                    if (str.length > 0) {
                        str = str.substr(0, str.length - 1);
                    }

                    arr = [];
                    if (VueObj.headstate == false) {
                        var url = MAPURL + 'map/buildings?householderid=' + VueObj.serialID
                        console.log(shuzu)
                        $.ajax({
                            type: 'get',
                            url: url,
                            contentType: 'application/json',
                            dataType: 'json',
                            success: function (e) {
                                console.log(e)

                                for (var i = 0; i < e.length; i++) {
                                    arr.push(e[i].ID)
                                }

                                var dizi = MAPURL + 'map/rebindbuilding';
                                var datashu = {
                                    HouseHolder: VueObj.serialXZXM,
                                    HouseHolderID: VueObj.serialID,
                                    OldBuildings: arr,
                                    NewBuildings: shuzu,

                                };
                                console.log(datashu)
                                VueObj.updateOracleHUZU(str, function () {
                                    console.log(1)
                                    if (VueObj.zhuangtai == true) {
                                        $.ajax({
                                            url: dizi,
                                            type: 'post',
                                            contentType: 'application/json',
                                            dataType: 'json',
                                            data: JSON.stringify(datashu),
                                            success: function (ret) {
                                                console.log(ret)
                                                shuzu = []
                                                xiugai = []
                                                MAPhouse.remove()
                                                setTimeout(function () {
                                                    var url = tileLayer
                                                    MAPhouse = new L.tileLayer.wms(url, {
                                                        layers: 'xatree:mapconfig_building',
                                                        crs: L.CRS.EPSG4326,
                                                        serverType: new Date().getTime() + "",
                                                        format: 'image/png',
                                                        minZoom: 11,
                                                        maxZoom: 21,
                                                        transparent: true
                                                    }).addTo(map);
                                                }, 100);
                                                VueObj.bianhaoif = false;
                                                HUZUTU.remove()
                                                markers.remove()
                                                var icon = L.icon({
                                                    iconSize: [30, 30],
                                                    iconAnchor: [0, 0],
                                                    iconUrl: "./img/add.png",
                                                });
                                                point = [0, 0];
                                                markers = new L.marker(point, {
                                                    icon: icon,
                                                }).addTo(map);
                                                markers.on('click', markerClickss);
                                                HUZUTU = new L.featureGroup().addTo(map);
                                                loadBuildingEmptyData(); //加载空房屋图层
                                            }
                                        });
                                    }
                                });

                            },
                            fail: function (d) {
                                VueObj.buildingLoading = false;
                            }
                        });
                    } else {

                        for (var i = 0; i < VueObj.TXBHss.split(",").length; i++) {
                            arr.push(VueObj.TXBHss.split(",")[i])
                        }
                        var ass = VueObj.TXBHss.split(",");
                        var dizi = MAPURL + 'map/rebindbuilding';
                        var datashu = {
                            HouseHolder: VueObj.serialXZXM,
                            HouseHolderID: VueObj.serialID,
                            OldBuildings: arr,
                            NewBuildings: shuzu,

                        };
                        VueObj.updateOracleHUZU(str, function () {
                            if (VueObj.zhuangtai == true) {
                                $.ajax({
                                    url: dizi,
                                    type: 'post',
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    data: JSON.stringify(datashu),
                                    success: function (ret) {
                                        console.log(ret)
                                        MAPhouse.remove()
                                        setTimeout(function () {
                                            var url = tileLayer
                                            MAPhouse = new L.tileLayer.wms(url, {
                                                layers: 'xatree:mapconfig_building',
                                                crs: L.CRS.EPSG4326,
                                                serverType: new Date().getTime() + "",
                                                format: 'image/png',
                                                minZoom: 11,
                                                maxZoom: 21,
                                                transparent: true
                                            }).addTo(map);
                                        }, 100);
                                        VueObj.bianhaoif = false;
                                        HUZUTU.remove()
                                        markers.remove()
                                        var icon = L.icon({
                                            iconSize: [30, 30],
                                            iconAnchor: [0, 0],
                                            iconUrl: "./img/add.png",
                                        });
                                        point = [0, 0];
                                        markers = new L.marker(point, {
                                            icon: icon,
                                        }).addTo(map);
                                        markers.on('click', markerClickss);
                                        HUZUTU = new L.featureGroup().addTo(map);
                                        loadBuildingEmptyData(); //加载空房屋图层
                                    }
                                });
                            }
                        });


                    }


                    VueObj.modifierHouse = false
                    console.log(shuzu)

                }
            }
        }
        //加载地图的点击方法
        function markerClick(e) {

            if (VueObj.bianhaoif == true) {
                var Y = e.target.options.arr.WKT.split("(")[1].split(")")[0].split(" ")[0];
                var X = e.target.options.arr.WKT.split("(")[1].split(")")[0].split(" ")[1];
                later = [X, Y]
                if (e.target.options.arr.Status == 3 || e.target.options.arr.Status == 4 || e.target.options.arr.Status == 5) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian1.png",
                    });
                } else if (e.target.options.arr.Status == 4) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian2.png",
                    });
                } else if (e.target.options.arr.Status == 5) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian3.png",
                    });
                } else if (e.target.options.arr.Status == 0) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian1.png",
                    });
                } else if (e.target.options.arr.Status == 1) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian2.png",
                    });
                } else if (e.target.options.arr.Status == 2) {
                    var icon = L.icon({
                        iconSize: [30, 30],
                        iconAnchor: [20, 20],
                        iconUrl: "./img/dadian3.png",
                    });
                }
                var y = e.target.options.arr.WKT.split("(")[1].split(")")[0].split(" ")[0];
                var x = e.target.options.arr.WKT.split("(")[1].split(")")[0].split(" ")[1];
                console.log(e.target.options.arr)
                point = [x, y]
                markers = new L.marker(point, {
                    icon: icon,
                }).addTo(map);

                console.log(e.target.options.arr.WKT.split("(")[1].split(")")[0])
                markers.bindPopup('<div id="popupWrapss"></div>', {
                    direction: "top",
                    offset: [0, 0],
                    permanent: false,
                    className: "div_tooltip"
                }).openPopup();
                var popupContent = Vue.extend({
                    template: '<div  class="mycontainer"  @click="clickLineWidth"></div>',
                    methods: {
                        clickLineWidth: function () {
                            if (VueObj.headstate == true) {
                                if (VueObj.modifier == false) {
                                    var url = MAPURL + 'map/pointbuildingedit';
                                    var str = ""
                                    for (var a = 0; a < shuzu.length; a++) {
                                        str += shuzu[a] + ","
                                    }
                                    if (str.length > 0) {
                                        str = str.substr(0, str.length - 1);
                                    }
                                    VueObj.updateOracleHouseHost(str);
                                    for (var i = 0; i < HeadQuantity.length; i++) {
                                        $.ajax({
                                            url: url,
                                            type: 'post',
                                            contentType: 'application/json',
                                            dataType: 'json',
                                            data: JSON.stringify(HeadQuantity[i]),
                                            success: function (ret) {
                                                console.log(ret)
                                                loadBuildingEmptyData()
                                            }
                                        });
                                    }
                                } else {
                                    arr = [];
                                    for (var i = 0; i < VueObj.TXBHss.split(",").length; i++) {
                                        arr.push(VueObj.TXBHss.split(",")[i])
                                    }
                                    var ass = VueObj.TXBHss.split(",");
                                    var dizi = MAPURL + 'map/rebindpointbuilding';
                                    var datashu = {
                                        HouseHolder: VueObj.serialXZXM,
                                        HouseHolderID: VueObj.serialID,
                                        OldBuildings: arr,
                                        NewBuildings: shuzu,

                                    };
                                    console.log(datashu)
                                    $.ajax({
                                        url: dizi,
                                        type: 'post',
                                        contentType: 'application/json',
                                        dataType: 'json',
                                        data: JSON.stringify(datashu),
                                        success: function (ret) {
                                            console.log(ret)
                                            loadBuildingEmptyData()
                                        }
                                    });
                                    VueObj.modifierHouse = false
                                    VueObj.updateOracleHouseHost(str);
                                    console.log(shuzu)

                                }
                            } else {
                                if (VueObj.modifier == false) {
                                    var url = MAPURL + 'map/buildingedit';
                                    var str = ""
                                    for (var a = 0; a < shuzu.length; a++) {
                                        str += shuzu[a] + ","
                                    }
                                    if (str.length > 0) {
                                        str = str.substr(0, str.length - 1);
                                    }
                                    VueObj.updateOracleHUZU(str);
                                    setTimeout(function () {
                                        if (VueObj.zhuangtai == true) {
                                            for (var i = 0; i < HeadQuantity.length; i++) {
                                                $.ajax({
                                                    url: url,
                                                    type: 'post',
                                                    contentType: 'application/json',
                                                    dataType: 'json',
                                                    data: JSON.stringify(HeadQuantity[i]),
                                                    success: function (ret) {
                                                        console.log(ret)
                                                        MAPhouse.remove()
                                                        var url = tileLayer
                                                        MAPhouse = new L.tileLayer.wms(url, {
                                                            layers: 'xatree:mapconfig_building',
                                                            crs: L.CRS.EPSG4326,
                                                            serverType: new Date().getTime() + "",
                                                            format: 'image/png',
                                                            minZoom: 11,
                                                            maxZoom: 21,
                                                            transparent: true
                                                        }).addTo(map);
                                                        VueObj.bianhaoif = false;
                                                        HUZUTU.remove()
                                                        markers.remove()
                                                        var icon = L.icon({
                                                            iconSize: [30, 30],
                                                            iconAnchor: [0, 0],
                                                            iconUrl: "./img/add.png",
                                                        });
                                                        point = [0, 0];
                                                        markers = new L.marker(point, {
                                                            icon: icon,
                                                        }).addTo(map);
                                                        markers.on('click', markerClickss);
                                                        HUZUTU = new L.featureGroup().addTo(map);
                                                        loadBuildingEmptyData()
                                                    }
                                                });
                                            }
                                        }
                                    }, 2000)
                                    var a1 = '<object type="text/html" data=' + '"../systemcenter/tudiedit.html?TDBH=' + e.target.options.arr.DKBH + '"; width="100%" height="100%"></object>';
                                    //给对号添加绑定事件
                                } else {
                                    arr = [];
                                    for (var i = 0; i < VueObj.TXBHss.split(",").length; i++) {
                                        arr.push(VueObj.TXBHss.split(",")[i])
                                    }
                                    var ass = VueObj.TXBHss.split(",");
                                    var dizi = MAPURL + 'map/rebindbuilding';
                                    var datashu = {
                                        HouseHolder: VueObj.serialXZXM,
                                        HouseHolderID: VueObj.serialID,
                                        OldBuildings: arr,
                                        NewBuildings: shuzu,

                                    };
                                    VueObj.updateOracleHUZU(str);
                                    setTimeout(function () {
                                        if (VueObj.zhuangtai == true) {
                                            $.ajax({
                                                url: dizi,
                                                type: 'post',
                                                contentType: 'application/json',
                                                dataType: 'json',
                                                data: JSON.stringify(datashu),
                                                success: function (ret) {
                                                    console.log(ret)
                                                    MAPhouse.remove()
                                                    setTimeout(function () {
                                                        var url = tileLayer
                                                        MAPhouse = new L.tileLayer.wms(url, {
                                                            layers: 'xatree:mapconfig_building',
                                                            crs: L.CRS.EPSG4326,
                                                            serverType: new Date().getTime() + "",
                                                            format: 'image/png',
                                                            minZoom: 11,
                                                            maxZoom: 21,
                                                            transparent: true
                                                        }).addTo(map);
                                                    }, 100);
                                                    VueObj.bianhaoif = false;
                                                    HUZUTU.remove()
                                                    markers.remove()
                                                    var icon = L.icon({
                                                        iconSize: [30, 30],
                                                        iconAnchor: [0, 0],
                                                        iconUrl: "./img/add.png",
                                                    });
                                                    point = [0, 0];
                                                    markers = new L.marker(point, {
                                                        icon: icon,
                                                    }).addTo(map);
                                                    markers.on('click', markerClickss);
                                                    HUZUTU = new L.featureGroup().addTo(map);
                                                    loadBuildingEmptyData()
                                                }
                                            });
                                        }
                                    }, 2000)


                                    console.log(datashu)

                                    VueObj.modifierHouse = false

                                    console.log(shuzu)

                                }
                            }
                        }
                    }
                });
                new popupContent().$mount('#popupWrapss');
                var url = MAPURL + 'map/building';
                console.log(e)
                var serialXZXM = VueObj.serialXZXM;
                var serialID = VueObj.serialID
                if (e.target.options.arr.HouseHolder == "") {
                    if (e.target.options.arr.Status == 3) {
                        Status = 4
                    } else {
                        Status = 1
                    }
                } else if (e.target.options.arr.HouseHolder != null || e.target.options.arr.HouseHolder == "") {
                    if (e.target.options.arr.Status == 4) {
                        Status = 5
                    } else if (e.target.options.arr.Status == 5) {
                        Status = 5
                    } else {
                        Status = 2
                    }
                    VueObj.serialXZXM = VueObj.serialXZXM + "," + e.target.options.arr.HouseHolder;
                    VueObj.serialID = VueObj.serialID + "," + e.target.options.arr.HouseHolderID;


                } else {
                    if (e.target.options.arr.Status == 3) {
                        Status = 4
                    } else {
                        Status = 1
                    }
                }
                if (VueObj.modifier == false) {
                    var datas = {
                        ID: e.target.options.arr.ID,
                        HouseHolder: VueObj.serialXZXM,
                        HouseHolderID: VueObj.serialID,
                        MCID: treeTypes,
                        WKT: e.target.options.arr.WKT,
                        Status: Status,
                        BuildingPN: e.target.options.arr.BuildingPN,
                        BuildingArea: e.target.options.arr.BuildingArea,
                        FileName: e.target.options.arr.FileName,
                        LandArea: e.target.options.arr.LandArea,
                    };
                    HeadQuantity.push(datas)
                    console.log(HeadQuantity)
                    console.log(VueObj.serialXZXM)
                    VueObj.serialXZXM = serialXZXM;
                    VueObj.serialID = serialID;
                    shuzu.push(e.target.options.arr.ID)
                    console.log(datas)
                } else {
                    shuzu.push(e.target.options.arr.ID)
                }


            } else {
                console.log(e)
                VueObj.map_arr(e.target.options.arr.ID)
            }
        }
        function a1(e) {
            console.log(xiugai)
            var poo = []
            if (VueObj.bianhaoif == true) {
                e.target.remove()

                if (VueObj.headstate == false) {
                    for (var i = 0; i < xiugai.length; i++) {
                        if (xiugai[i] != e.target.options.id) {
                            poo.push(xiugai[i])
                        }
                    }
                } else {
                    for (var i = 0; i < shuzu.length; i++) {
                        if (shuzu[i] != e.target.options.id) {
                            poo.push(shuzu[i])
                        }
                    }
                }
                point = [e.latlng.lat, e.latlng.lng];
                markers.setLatLng(point)
                if (VueObj.headstate == false) {
                    xiugai = poo
                } else {
                    shuzu = poo
                }

            } else {
                var url = MAPURL + 'map/building/' + e.target.options.id
                $.ajax({
                    type: 'get',
                    url: url,
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (row) {
                        console.log(row)
                        VueObj.map_arr(row.ID)
                        loadBuildingEmptyData()
                    },
                    fail: function (d) {
                        VueObj.buildingLoading = false;
                    }
                });
            }


        }
        //点击地图的方法
        function onMapClick(e) {

            var _this = this
            var Status = ""
            console.log(e)
            var Y = e.latlng.lng;
            var X = e.latlng.lat;
            later = [X, Y]
            if (VueObj.bianhaoif == true) {
                if (VueObj.duoxuan == true) {
                    if (VueObj.imgadd == true) {
                        //添加户主绑定信息的参数
                        VueObj.additionhouse(e.target.options.id, function () {
                            if (VueObj.statubar == true) {
                                var url = MAPURL + 'map/buildingedit';
                                if (e.target.options.arr.HouseHolder != null || e.target.options.arr.HouseHolder == "") {
                                    console.log(e)
                                    console.log(e.target.options.arr.HouseHolder)
                                    if (e.target.options.arr.Status == 4) {
                                        Status = 5
                                    } else if (e.target.options.arr.Status == 5) {
                                        Status = 5
                                    } else if (e.target.options.arr.Status == 0) {
                                        Status = 1
                                    } if (e.target.options.arr.Status == 1) {
                                        Status = 2
                                    } if (e.target.options.arr.Status == 2) {
                                        Status = 2
                                    }
                                    if (e.target.options.arr.Status == 3) {
                                        Status = 4
                                    }
                                    VueObj.serialXZXM = VueObj.serialXZXM + "," + e.target.options.arr.HouseHolder;
                                    VueObj.serialID = VueObj.serialID + "," + e.target.options.arr.HouseHolderID;

                                } else {
                                    if (e.target.options.arr.Status == 3) {
                                        Status = 4
                                    } else {
                                        Status = 1
                                    }

                                }
                                var datas = {
                                    ID: e.target.options.id,
                                    HouseHolder: VueObj.serialXZXM,
                                    HouseHolderID: VueObj.serialID,
                                    MCID: treeTypes,
                                    WKT: e.target.options.WKT,
                                    Status: Status,
                                    BuildingPN: e.target.options.arr.BuildingPN,
                                    BuildingArea: e.target.options.arr.BuildingArea,
                                    FileName: e.target.options.arr.FileName,
                                    LandArea: e.target.options.arr.LandArea,
                                };
                                console.log(datas)
                                $.ajax({
                                    url: url,
                                    type: 'post',
                                    contentType: 'application/json',
                                    dataType: 'json',
                                    data: JSON.stringify(datas),
                                    success: function (ret) {
                                        MAPhouse.remove()
                                        //    setTimeout(function () {
                                        var url = tileLayer
                                        MAPhouse = new L.tileLayer.wms(url, {
                                            layers: 'xatree:mapconfig_building',
                                            crs: L.CRS.EPSG4326,
                                            serverType: new Date().getTime() + "",
                                            format: 'image/png',
                                            minZoom: 11,
                                            maxZoom: 21,
                                            transparent: true
                                        }).addTo(map);
                                        // }, 100);
                                        shuzu = []
                                        VueObj.bianhaoif = false;
                                        HUZUTU.remove()
                                        markers.remove()
                                        var icon = L.icon({
                                            iconSize: [30, 30],
                                            iconAnchor: [0, 0],
                                            iconUrl: "./img/add.png",
                                        });
                                        point = [0, 0];
                                        markers = new L.marker(point, {
                                            icon: icon,
                                        }).addTo(map);
                                        markers.on('click', markerClickss);
                                        HUZUTU = new L.featureGroup().addTo(map);
                                        loadBuildingEmptyData(); //加载空房屋图层
                                    }
                                });
                            }
                        });


                    } else {
                       //显示当前点击房屋的颜色
                        var latlngs = []
                        for (var q = 0; q < e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                            e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                            var x = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                            var y = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                            latlngs.push([y, x]);
                        }
                        housearr.push(latlngs)
                        if (e.target.options.arr.Status == 0) {
                            linez = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        } else if (e.target.options.arr.Status == 1) {
                            linez = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        } else if (e.target.options.arr.Status == 2) {
                            linez = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 1, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        } else if (e.target.options.arr.Status == 3) {
                            linez = new L.polygon(latlngs, { color: 'red', noClip: true, fillColor: 'red', opacity: 0.5, fillOpacity: 0.5, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        } else if (e.target.options.arr.Status == 4) {
                            linez = new L.polygon(latlngs, { color: 'green', fillColor: 'green', opacity: 0.5, fillOpacity: 0.5, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        } else if (e.target.options.arr.Status == 5) {
                            linez = new L.polygon(latlngs, { color: 'yellow', fillColor: 'yellow', opacity: 0.5, fillOpacity: 0.5, weight: 0.2, arr: e.target.options.arr })
                                .addTo(HUZUTU);
                        }

                        shuzuweizi.push(e.target.options.arr)
                        linez.bringToFront()
                        linez.on('click', onMapClickss);
                        point = [e.latlng.lat, e.latlng.lng];
                        markers.setLatLng(point)


                        if (VueObj.statubar == true) {



                            if (VueObj.modifier == false) {
                                var url = MAPURL + 'map/building';
                                var serialXZXM = VueObj.serialXZXM;
                                var serialID = VueObj.serialID
                                console.log(e.target.options.arr.Status == 3)
                                if (e.target.options.arr.HouseHolder == "") {
                                    if (e.target.options.arr.Status == 3) {
                                        Status = 4
                                    } else {
                                        Status = 1
                                    }
                                } else if (e.target.options.arr.HouseHolder != null || e.target.options.arr.HouseHolder == "") {
                                    if (e.target.options.arr.Status == 4) {
                                        Status = 5
                                    } else if (e.target.options.arr.Status == 5) {
                                        Status = 5
                                    } else {
                                        Status = 2
                                    }
                                    console.log(e.target.options.arr.HouseHolder)
                                    VueObj.serialXZXM = VueObj.serialXZXM + "," + e.target.options.arr.HouseHolder;
                                    VueObj.serialID = VueObj.serialID + "," + e.target.options.arr.HouseHolderID;


                                } else {
                                    if (e.target.options.arr.Status == 3) {
                                        Status = 4
                                    } else {
                                        Status = 1
                                    }
                                }
                                console.log(Status)
                                var datas = {
                                    ID: e.target.options.id,
                                    HouseHolder: VueObj.serialXZXM,
                                    HouseHolderID: VueObj.serialID,
                                    MCID: treeTypes,
                                    WKT: e.target.options.WKT,
                                    Status: Status,
                                    BuildingPN: e.target.options.arr.BuildingPN,
                                    BuildingArea: e.target.options.arr.BuildingArea,
                                    FileName: e.target.options.arr.FileName,
                                    LandArea: e.target.options.arr.LandArea,
                                };
                                HeadQuantity.push(datas)
                                console.log(serialXZXM)
                                console.log(VueObj.serialXZXM)
                                VueObj.serialXZXM = serialXZXM;
                                VueObj.serialID = serialID;
                                shuzu.push(e.target.options.id)
                                console.log(datas)
                            } else {
                                shuzu.push(e.target.options.id)
                            }

                        }
                    }

                } else {
                    var url = MAPURL + 'map/buildingedit';
                    if (e.target.options.arr.HouseHolder != null || e.target.options.arr.HouseHolder == "") {
                        if (e.target.options.arr.Status == 4) {
                            Status = 5
                        } else if (e.target.options.arr.Status == 5) {
                            Status = 5
                        } else {
                            Status = 2
                        }
                        VueObj.serialXZXM = VueObj.serialXZXM + "," + e.target.options.arr.HouseHolder;
                        VueObj.serialID = VueObj.serialID + "," + e.target.options.arr.HouseHolderID;

                    } else {
                        if (e.target.options.arr.Status == 3) {
                            Status = 4
                        } else {
                            Status = 1
                        }

                    }
                    if (VueObj.modifier == false) {
                        var datas = {
                            ID: e.target.options.id,
                            HouseHolder: VueObj.serialXZXM,
                            HouseHolderID: VueObj.serialID,
                            MCID: treeTypes,
                            WKT: e.target.options.WKT,
                            Status: Status,
                            BuildingPN: e.target.options.arr.BuildingPN,
                            BuildingArea: e.target.options.arr.BuildingArea,
                            FileName: e.target.options.arr.FileName,
                            LandArea: e.target.options.arr.LandArea,
                        };
                        console.log(datas)
                        $.ajax({
                            url: url,
                            type: 'post',
                            contentType: 'application/json',
                            dataType: 'json',
                            data: JSON.stringify(datas),
                            success: function (ret) {
                                console.log(ret)
                                loadBuildingEmptyData()

                            }
                        });
                    }

                    shuzu.push(e.target.options.id)
                    console.log(e.target.options.id)
                }


            } else {
                MAPtu.remove()
                MAPtu = new L.featureGroup().addTo(map);
                if (e.target.options.arr.Status == 3 || e.target.options.arr.Status == 4 || e.target.options.arr.Status == 5) {
                    MAPtu.remove()
                    MAPtu = new L.featureGroup().addTo(map);
                    var latlngs = [];
                    LayerID = e.target.options.arr.ID
                    VueObj.isShowToolBar = true;
                    for (var q = 0; q < e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                        e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                        var x = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                        var y = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                        latlngs.push([y, x]);

                    }
                    xiugaitucen = new L.polygon(latlngs, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 0.5, fillOpacity: 0.5, weight: 0.2, arr: e.target.options.arr })
                        .addTo(MAPtu);
                } else {
                    VueObj.isShowToolBar = false;
                }
                xzc = 0
                console.log(VueObj.datashuju)
                for (var i = 0; i < VueObj.datashuju.length; i++) {
                    if (e.target.options.arr.HouseHolderID == VueObj.datashuju[i].ID) {
                        console.log(i + 1)
                        xzc = i + 1
                    }
                }
                console.log(Math.ceil(xzc / VueObj.pageSize))
                console.log(xzc % VueObj.pageSize)
                if (xzc != 0) {


                    if (Math.ceil(xzc / VueObj.pageSize) != 0) {

                        VueObj.currentPage1 = Math.ceil(xzc / VueObj.pageSize)

                        VueObj.page_data(Math.ceil(xzc / VueObj.pageSize))
                    }
                }


                var latlngs = []
                for (var q = 0; q < e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",").length; q++) {
                    e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")
                    var x = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[0]);
                    var y = parseFloat(e.target.options.arr.WKT.split("(")[2].split(")")[0].split(",")[q].split(" ")[1]);
                    latlngs.push([y, x]);

                }
                if (e.target.options.arr.Status == 0) {
                    xiugaitucen = new L.polygon(latlngs, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 0.5, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                        .addTo(MAPtu);
                } else if (e.target.options.arr.Status == 1) {
                    xiugaitucen = new L.polygon(latlngs, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 0.5, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                        .addTo(MAPtu);
                } else if (e.target.options.arr.Status == 2) {
                    xiugaitucen = new L.polygon(latlngs, { color: 'yellow', noClip: true, fillColor: 'yellow', opacity: 0.5, fillOpacity: 1, weight: 0.2, arr: e.target.options.arr })
                        .addTo(MAPtu);
                }

                var url = MAPURL + 'map/building/' + e.target.options.id
                $.ajax({
                    type: 'get',
                    url: url,
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (row) {
                        console.log(row)
                        VueObj.map_arr(row.ID)
                        loadBuildingEmptyData()
                    },
                    fail: function (d) {
                        VueObj.buildingLoading = false;
                    }
                });
            }

        };

        window.onkeydown = function (e) {
            if (e.keyCode == 13) {
                console.log(VueObj.input)
                if (VueObj.input != '') {
                    VueObj.figure_inquire()
                }
            }

        }
        //定义一些常量
        var x_PI = 3.14159265358979324 * 3000.0 / 180.0;
        var PI = 3.1415926535897932384626;
        var a = 6378245.0;
        var ee = 0.00669342162296594323;

        //百度坐标转火星坐标
        function bd09togcj02(bd_lon, bd_lat) {
            var x_pi = 3.14159265358979324 * 3000.0 / 180.0;
            var x = bd_lon - 0.0065;
            var y = bd_lat - 0.006;
            var z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * x_pi);
            var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * x_pi);
            var gg_lng = z * Math.cos(theta);
            var gg_lat = z * Math.sin(theta);
            // return [gg_lng, gg_lat]
            console.log(gg_lng, gg_lat)
            gcj02towgs84(gg_lng, gg_lat)
        }
        /**
         * GCJ02 转换为 WGS84
         * @param lng
         * @param lat
         * @returns {*[]}
         */
        function gcj02towgs84(lng, lat) {

            var dlat = transformlat(lng - 105.0, lat - 35.0);
            var dlng = transformlng(lng - 105.0, lat - 35.0);
            var radlat = lat / 180.0 * PI;
            var magic = Math.sin(radlat);
            magic = 1 - ee * magic * magic;
            var sqrtmagic = Math.sqrt(magic);
            dlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * PI);
            dlng = (dlng * 180.0) / (a / sqrtmagic * Math.cos(radlat) * PI);
            mglat = lat + dlat;
            mglng = lng + dlng;
            var latlngs = [lat * 2 - mglat, lng * 2 - mglng]
            markers.remove()
            map.setView(latlngs, 17);
            var icon = L.icon({
                iconSize: [23, 37],
                iconAnchor: [23, 37],
                iconUrl: "./img/weizi.png",
            });
            point = [0, 0];
            markers = new L.marker(latlngs, {
                icon: icon,
            }).addTo(MAPhuzu);
            VueObj.PositioningIf = true;

        }
        function transformlat(lng, lat) {
            var ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));
            ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
            ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;
            ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;
            return ret
        }

        function transformlng(lng, lat) {
            var ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));
            ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
            ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;
            ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;
            return ret
        }
        window.onload = function () {
            var one = document.getElementById('one');
            //判断鼠标是否按下
            var p = false;
            //鼠标按下处在页面中的水平偏移
            var dx = 0;
            //鼠标按下处在页面中的垂直偏移
            var dy = 0;
            //div在页面中的水平偏移
            var sx = 0;
            //div在页面中的垂直偏移
            var sy = 0;

            //鼠标按下时
            one.onmousedown = function (event) {
                if (!p) {
                    p = true;
                }
                //处理兼容性和滚动条
                var event = event || window.event;
                var scrollLeft = document.documentElement.scrollLeft;
                var scrollTop = document.documentElement.scrollTop;
                var pageX = event.pageX || event.clientX + scrollLeft;
                var pageY = event.pageY || event.clientY + scrollTop;
                dx = pageX;
                dy = pageY;
                sx = one.offsetLeft;
                sy = one.offsetTop;
            }

            //鼠标移动时
            document.onmousemove = function (event) {
                if (p) {
                    var event = event || window.event;
                    var scrollLeft = document.documentElement.scrollLeft;
                    var scrollTop = document.documentElement.scrollTop;
                    var pageX = event.pageX || event.clientX + scrollLeft;
                    var pageY = event.pageY || event.clientY + scrollTop;
                    one.style.left = pageX - (dx - sx) + 'px';
                    one.style.top = pageY - (dy - sy) + 'px';
                }
            }

            //鼠标松开时
            document.onmouseup = function () {
                if (p) {
                    p = false;
                }
            }
        }
        //程序定位
        function tlocation() {
            var set = setInterval(function () {
                if (top.window._hzvmap_locationInfo != undefined && top.window._hzvmap_locationInfo != null) {
                    var latlng = [parseFloat(top.window._hzvmap_locationInfo.split(",")[1]), parseFloat(top.window._hzvmap_locationInfo.split(",")[0])];
                    markers.remove()
                    map.setView(latlng, 17);
                    var icon = L.icon({
                        iconSize: [23, 37],
                        iconAnchor: [23, 37],
                        iconUrl: "./img/weizi.png",
                    });
                    point = [0, 0];
                    markers = new L.marker(latlng, {
                        icon: icon,
                    }).addTo(MAPhuzu);
                    window.clearInterval(set);
                    VueObj.PositioningIf = true;
                    top.window._hzvmap_locationInfo = null;

                }
            }, 100)
        }
    </script>
</body>


</html>